<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>SmartCalories - Nháº­t KÃ½ Ä‚n Uá»‘ng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/static/logo.png" type="image/png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Google Fonts: Quicksand -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Quicksand', 'Segoe UI', Arial, sans-serif; }
    .glass {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 32px 0 rgba(31,38,135,0.12);
    }
    .header-gradient {
      background: linear-gradient(90deg, #fbc3bc);
    }
    .header-shadow {
      box-shadow: 0 4px 24px 0 rgba(96,165,250,0.10);
    }
    .header-logo {
      box-shadow: 0 2px 8px #60a5fa33;
      border: 3px solid #fff;
    }
    .header-btn {
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .header-btn:hover {
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 4px 16px #60a5fa33;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-pink-50 to-blue-100 min-h-screen text-gray-800">
<header class="header-gradient header-shadow relative flex flex-col items-center px-2 md:px-8 py-3 md:py-5 sticky top-0 z-40 glass">
  <button id="sidebarToggleBtn"
    class="md:hidden text-white text-4xl absolute top-7 left-3 ml-2"
    onclick="toggleSidebar()">â˜°</button>
  <div class="flex flex-col w-full md:flex-row md:items-center md:justify-between">
    <div class="flex items-center gap-3 md:gap-5 justify-center md:justify-start w-full md:w-auto">
      <img src="/static/logo.png" class="header-logo block w-12 h-12 sm:w-14 sm:h-14 rounded-full bg-white" alt="Logo" />
      <button onclick="goHome()"
        class="text-3xl sm:text-5xl font-extrabold text-white tracking-wide focus:outline-none drop-shadow-lg hover:scale-105 transition-all duration-200">
        <span class="bg-gradient-to-r from-blue-500 to-pink-400 bg-clip-text text-transparent">SmartCalories</span>
      </button>
    </div>
    <div class="flex items-center gap-2 sm:gap-4 justify-center md:justify-end mt-2 md:mt-0 w-full md:w-auto">
      <img src="{{ user.avatar_url or '/static/default-avatar.png' }}"
        alt="Avatar"
        class="w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 border-white shadow-lg ring-2 ring-blue-300" />
      <span class="hidden sm:inline text-white font-semibold text-base sm:text-lg truncate max-w-[180px] sm:max-w-[320px] md:max-w-[400px] lg:max-w-[600px] drop-shadow">
        {{ fullname }}
      </span>
      <a href="/logout"
        class="header-btn bg-white/30 hover:bg-white/60 text-blue-700 px-4 sm:px-5 py-2 rounded-xl font-bold shadow transition flex items-center gap-2 text-base sm:text-lg border border-blue-200">
        <span>ğŸšª</span> <span class="hidden xs:inline">ÄÄƒng xuáº¥t</span>
      </a>
    </div>
  </div>
</header>
<!-- Dashboard layout -->
<main class="flex flex-col md:flex-row h-auto md:h-[calc(100vh-80px)] transition-all duration-300 ease-in-out">
    <!-- Sidebar -->
<!-- Sidebar - Pháº§n cáº§n thay tháº¿ trong file index.html -->
<aside id="sidebar"
  class="w-full md:w-64 bg-[#fbc3bc] via-blue-100 to-blue-50 text-gray-800 p-4 space-y-2 shadow-2xl fixed md:static top-0 left-0 h-screen md:h-auto z-50 md:z-auto transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out rounded-r-3xl md:rounded-none border-r-2 border-blue-200"
  style="max-width:100vw;">
<div class="relative w-full flex items-center justify-between px-2">
<!-- NÃºt chá»‰ hiá»ƒn thá»‹ á»Ÿ desktop -->
<button
  id=""
  class="hidden md:flex absolute top-0 right-[0.4rem] z-50 w-10 h-10 bg-white border border-pink-200 text-pink-600 rounded-full shadow-md items-center justify-center hover:bg-pink-100 transition"
  onclick="toggleSidebarCollapse()"
  title="Thu gá»n/má»Ÿ rá»™ng sidebar"
>
  <svg id="sidebarToggleIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
  </svg>
</button>

  <!-- Giá»¯ nguyÃªn cho mobile -->
<button
  id="sidebarMobileBtn"
  class="md:hidden mb-4 mt-2 text-pink-600 text-4xl absolute right-4 top-0 z-20"
  onclick="toggleSidebar()"
>
  â˜°
</button>
</div>
  <nav class="flex flex-col gap-2 pt-12">
    <button onclick="switchView('meals')" id="btn-meals"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ“‹</span> <span class="sidebar-text">Danh sÃ¡ch mÃ³n</span>
    </button>
    {% if user.role != 'admin' %}
    <button onclick="switchView('log')" id="btn-log"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ“–</span> <span class="sidebar-text">Nháº­t kÃ½ & PhÃ¢n tÃ­ch</span>
    </button>
    <button onclick="openSuggestModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ¥—</span> <span class="sidebar-text">Gá»£i Ã½ mÃ³n Äƒn</span>
    </button>
    <button onclick="openLogMealModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ“</span> <span class="sidebar-text">Ghi nháº­t kÃ½</span>
    </button>
    <button onclick="openAddMealModal()" class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">â•</span> <span class="sidebar-text">ThÃªm mÃ³n Äƒn</span>
    </button>
    <button onclick="openActivityModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸƒ</span> <span class="sidebar-text">Hoáº¡t Ä‘á»™ng thá»ƒ cháº¥t</span>
    </button>
    {% endif %}
    <button onclick="openProfileModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ‘¤</span> <span class="sidebar-text">ThÃ´ng tin cÃ¡ nhÃ¢n</span>
    </button>
    {% if user.role == 'admin' %}
    <button onclick="openUserModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ‘¥</span> <span class="sidebar-text">Quáº£n lÃ½ ngÆ°á»i dÃ¹ng</span>
    </button>
    <button onclick="openActivityLogModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ“œ</span> <span class="sidebar-text">Nháº­t kÃ½ hoáº¡t Ä‘á»™ng</span>
    </button>
    <button onclick="openLoginLogModal()"
      class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none">
      <span class="text-2xl">ğŸ”‘</span> <span class="sidebar-text">Xem Ä‘Äƒng nháº­p</span>
    </button>
    {% endif %}
    <div class="relative group">
      <button class="sidebar-btn flex items-center gap-3 px-5 py-3 rounded-xl font-semibold text-lg transition-all duration-200 hover:bg-blue-500/20 hover:text-blue-700 focus:outline-none w-full">
        <span class="text-2xl">ğŸ“¤</span> <span class="sidebar-text">Xuáº¥t CSV</span>
      </button>
      <div class="absolute left-0 mt-1 hidden group-hover:block bg-white text-gray-800 shadow-lg rounded-lg overflow-hidden z-10 w-48">
        <a href="/export-csv?mode=today" class="block px-4 py-2 hover:bg-blue-100">ğŸ“† Xuáº¥t hÃ´m nay</a>
        <a href="/export-csv?mode=all" class="block px-4 py-2 hover:bg-blue-100">ğŸ“¦ Xuáº¥t táº¥t cáº£</a>
      </div>
    </div>
  </nav>
</aside>
 <!-- Lá»›p phá»§ cho thanh bÃªn trÃªn thiáº¿t bá»‹ di Ä‘á»™ng -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black/40 z-40 hidden md:hidden" onclick="toggleSidebar()"></div>
<!-- Content Area -->
<section class="flex-1 overflow-y-auto p-2 sm:px-6 sm:py-4 mt-2 md:mt-0">
<!-- Meals View -->
<div id="mealsView" class="hidden">
  <!-- Header vá»›i gradient vÃ  hiá»‡u á»©ng nÃ¢ng cao -->
  <div class="bg-gradient-to-br from-blue-50 via-pink-50 to-purple-50 rounded-3xl p-8 mb-8 border-2 border-pink-200 shadow-xl relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-pink-200/30 to-transparent rounded-full -translate-y-20 translate-x-20"></div>
    <div class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-blue-200/30 to-transparent rounded-full translate-y-16 -translate-x-16"></div>
    
    <div class="relative z-10">
      <h2 class="text-4xl font-bold mb-6 flex items-center gap-4 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
        <span class="text-5xl animate-bounce drop-shadow-lg">ğŸ½ï¸</span> 
        <div class="flex flex-col">
          <span>Danh sÃ¡ch mÃ³n Äƒn</span>
          <span class="text-lg font-normal text-gray-500">KhÃ¡m phÃ¡ tháº¿ giá»›i áº©m thá»±c</span>
        </div>
      </h2>
      
      <!-- Search form vá»›i hiá»‡u á»©ng glassmorphism nÃ¢ng cao -->
      <form method="get" action="/" class="w-full mb-6" onsubmit="return handleSearchForm(event)">
        <div class="flex flex-col lg:flex-row gap-4">
          <div class="flex-1 relative group">
            <div class="absolute inset-0 bg-gradient-to-r from-pink-400 to-purple-400 rounded-2xl blur opacity-25 group-hover:opacity-40 transition duration-300"></div>
            <div class="relative">
              <input type="text" name="search" placeholder="TÃ¬m kiáº¿m mÃ³n Äƒn yÃªu thÃ­ch cá»§a báº¡n..." value="{{ search | default('') }}"
                class="w-full h-14 border-2 border-pink-200 rounded-2xl px-6 pl-14 focus:outline-none focus:ring-4 focus:ring-pink-400/30 focus:border-pink-400 transition-all duration-300 text-base shadow-lg bg-white/90 backdrop-blur-sm hover:bg-white/95 font-medium" />
              <svg class="w-6 h-6 text-pink-400 absolute left-4 top-4 transition-colors group-hover:text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
              <div class="absolute right-3 top-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                Enter
              </div>
            </div>
          </div>
          <input type="hidden" name="view" value="meals" />
          <button type="submit" class="bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 hover:from-blue-500 hover:via-purple-500 hover:to-pink-500 text-white px-10 py-4 rounded-2xl font-bold transition-all duration-500 shadow-xl hover:shadow-2xl transform hover:scale-105 flex items-center gap-3 text-lg group">
            <span class="text-2xl group-hover:rotate-12 transition-transform">ğŸ”</span> 
            <span>TÃ¬m kiáº¿m</span>
            <div class="w-0 group-hover:w-8 h-0.5 bg-white rounded transition-all duration-300"></div>
          </button>
        </div>
      </form>
      
      <!-- Stats cards vá»›i hiá»‡u á»©ng nÃ¢ng cao -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="stats-card bg-gradient-to-br from-blue-100 to-blue-200 rounded-2xl p-5 border-2 border-blue-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-blue-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10">
            <div class="text-3xl font-bold text-blue-600 mb-1 group-hover:scale-110 transition-transform">{{ meals|length }}</div>
            <div class="text-sm text-blue-700 font-medium flex items-center gap-2">
              <span class="text-lg">ğŸ½ï¸</span>
              Tá»•ng mÃ³n Äƒn
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-green-100 to-green-200 rounded-2xl p-5 border-2 border-green-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-green-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10">
            <div class="text-3xl font-bold text-green-600 mb-1 group-hover:scale-110 transition-transform">ğŸ¥—</div>
            <div class="text-sm text-green-700 font-medium flex items-center gap-2">
              <span class="text-lg">âœ¨</span>
              Äa dáº¡ng thá»±c Ä‘Æ¡n
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-2xl p-5 border-2 border-yellow-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10">
            <div class="text-3xl font-bold text-yellow-600 mb-1 group-hover:scale-110 transition-transform">â­</div>
            <div class="text-sm text-yellow-700 font-medium flex items-center gap-2">
              <span class="text-lg">ğŸ†</span>
              Cháº¥t lÆ°á»£ng cao
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl p-5 border-2 border-purple-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10">
            <div class="text-3xl font-bold text-purple-600 mb-1 group-hover:scale-110 transition-transform">ğŸ†</div>
            <div class="text-sm text-purple-700 font-medium flex items-center gap-2">
              <span class="text-lg">ğŸ’«</span>
              HÃ ng Ä‘áº§u
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Meals grid -->
  <div class="meals-container">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
      {% for meal in meals %}
      <div class="meal-card group bg-white rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-700 overflow-hidden border-2 border-transparent hover:border-pink-200 transform hover:-translate-y-3 hover:scale-105 relative">
        <!-- Floating glow effect -->
        <div class="absolute inset-0 bg-gradient-to-br from-pink-100/0 via-purple-100/0 to-blue-100/0 group-hover:from-pink-100/30 group-hover:via-purple-100/20 group-hover:to-blue-100/30 transition-all duration-700 rounded-3xl pointer-events-none"></div>
        
        <!-- Image container with enhanced effects -->
        <div class="relative overflow-hidden rounded-t-3xl h-56">
          {% if meal.image_url %}
            <img src="{{ meal.image_url }}" alt="{{ meal.name }}" 
                 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
            
            <!-- Multi-layer overlay -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            
            <!-- Enhanced floating badges -->
            <div class="absolute top-4 left-4 flex flex-col gap-2">
              <span class="bg-white/95 backdrop-blur-md text-pink-600 px-4 py-2 rounded-full text-sm font-bold shadow-lg border border-pink-200 flex items-center gap-2">
                <span class="text-lg">ğŸ”¥</span>
                {{ ("%.0f"|format(meal.calories)) }} kcal
              </span>
            </div>
            
            <!-- Admin action buttons vá»›i hiá»‡u á»©ng nÃ¢ng cao -->
            {% if user.role == 'admin' %}
              <div class="absolute top-4 right-4 flex gap-3 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-2 group-hover:translate-y-0">
                <button class="editMealBtn action-btn bg-white/95 hover:bg-blue-100 text-blue-600 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-125 border-2 border-blue-200 hover:border-blue-400"
                  data-id="{{ meal._id }}"
                  data-name="{{ meal.name }}"
                  data-calories="{{ meal.calories }}"
                  data-protein="{{ meal.protein }}"
                  data-carbs="{{ meal.carbs }}"
                  data-fat="{{ meal.fat }}"
                  data-image-url="{{ meal.image_url }}"
                  title="Chá»‰nh sá»­a mÃ³n Äƒn">
                  <span class="text-lg">âœï¸</span>
                </button>
                <button onclick="openModal('{{ meal._id }}')" 
                        class="action-btn bg-white/95 hover:bg-red-100 text-red-600 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-125 border-2 border-red-200 hover:border-red-400" 
                        title="XÃ³a mÃ³n Äƒn">
                  <span class="text-lg">ğŸ—‘ï¸</span>
                </button>
              </div>
            {% endif %}
          {% else %}
            <div class="w-full h-full bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 flex items-center justify-center relative group-hover:from-pink-200 group-hover:via-purple-200 group-hover:to-blue-200 transition-all duration-700">
              <div class="text-8xl text-gray-400 animate-pulse group-hover:scale-110 transition-transform duration-500">ğŸ½ï¸</div>
              
              <!-- Admin buttons for no-image cards -->
              {% if user.role == 'admin' %}
                <div class="absolute top-4 right-4 flex gap-3 opacity-0 group-hover:opacity-100 transition-all duration-500">
                  <button class="editMealBtn action-btn bg-white/95 hover:bg-blue-100 text-blue-600 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-125"
                    data-id="{{ meal._id }}"
                    data-name="{{ meal.name }}"
                    data-calories="{{ meal.calories }}"
                    data-protein="{{ meal.protein }}"
                    data-carbs="{{ meal.carbs }}"
                    data-fat="{{ meal.fat }}"
                    data-image-url="{{ meal.image_url }}"
                    title="Chá»‰nh sá»­a mÃ³n Äƒn">
                    <span class="text-lg">âœï¸</span>
                  </button>
                  <button onclick="openModal('{{ meal._id }}')" 
                          class="action-btn bg-white/95 hover:bg-red-100 text-red-600 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-125" 
                          title="XÃ³a mÃ³n Äƒn">
                    <span class="text-lg">ğŸ—‘ï¸</span>
                  </button>
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
        
        <!-- Enhanced content section -->
        <div class="flex-1 flex flex-col justify-between p-6 relative z-10">
          <div>
            <!-- Meal title with enhanced typography -->
            <h3 class="meal-title text-2xl font-bold text-gray-800 mb-4 truncate group-hover:text-pink-600 transition-colors duration-300 flex items-center gap-2" 
                title="{{ meal.name }}">
              <span class="text-pink-500 text-sm">ğŸ´</span>
              {{ meal.name }}
            </h3>
            
            <!-- Enhanced nutrition grid -->
            <div class="nutrition-grid grid grid-cols-2 gap-3 mb-6">
              <div class="nutrition-badge bg-gradient-to-br from-green-100 to-green-200 border-2 border-green-300 px-4 py-3 rounded-2xl text-center transition-all duration-300 hover:from-green-200 hover:to-green-300 hover:scale-105 hover:shadow-lg cursor-pointer">
                <div class="flex items-center justify-center gap-2 mb-1">
                  <span class="text-lg">ğŸ’ª</span>
                  <span class="text-xs text-green-600 font-bold uppercase tracking-wider">Protein</span>
                </div>
                <div class="text-lg font-bold text-green-700">{{ ("%.1f"|format(meal.protein)) }}g</div>
              </div>
              
              <div class="nutrition-badge bg-gradient-to-br from-yellow-100 to-yellow-200 border-2 border-yellow-300 px-4 py-3 rounded-2xl text-center transition-all duration-300 hover:from-yellow-200 hover:to-yellow-300 hover:scale-105 hover:shadow-lg cursor-pointer">
                <div class="flex items-center justify-center gap-2 mb-1">
                  <span class="text-lg">ğŸ</span>
                  <span class="text-xs text-yellow-600 font-bold uppercase tracking-wider">Carbs</span>
                </div>
                <div class="text-lg font-bold text-yellow-700">{{ ("%.1f"|format(meal.carbs)) }}g</div>
              </div>
              
              <div class="nutrition-badge bg-gradient-to-br from-purple-100 to-purple-200 border-2 border-purple-300 px-4 py-3 rounded-2xl text-center transition-all duration-300 hover:from-purple-200 hover:to-purple-300 hover:scale-105 hover:shadow-lg cursor-pointer">
                <div class="flex items-center justify-center gap-2 mb-1">
                  <span class="text-lg">ğŸ¥‘</span>
                  <span class="text-xs text-purple-600 font-bold uppercase tracking-wider">Fat</span>
                </div>
                <div class="text-lg font-bold text-purple-700">{{ ("%.1f"|format(meal.fat)) }}g</div>
              </div>
              
              <div class="nutrition-badge bg-gradient-to-br from-pink-100 to-pink-200 border-2 border-pink-300 px-4 py-3 rounded-2xl text-center transition-all duration-300 hover:from-pink-200 hover:to-pink-300 hover:scale-105 hover:shadow-lg cursor-pointer">
                <div class="flex items-center justify-center gap-2 mb-1">
                  <span class="text-lg">ğŸ”¥</span>
                  <span class="text-xs text-pink-600 font-bold uppercase tracking-wider">Calo</span>
                </div>
                <div class="text-lg font-bold text-pink-700">{{ ("%.0f"|format(meal.calories)) }}</div>
              </div>
            </div>
          </div>
          
          <!-- Enhanced mobile action buttons -->
          {% if user.role == 'admin' %}
          <div class="mt-6 flex gap-3 sm:hidden">
            <button class="editMealBtn flex-1 bg-gradient-to-r from-blue-100 to-blue-200 hover:from-blue-200 hover:to-blue-300 text-blue-700 rounded-2xl py-3 font-bold transition-all duration-300 border-2 border-blue-300 hover:border-blue-400 hover:shadow-lg flex items-center justify-center gap-2"
              data-id="{{ meal._id }}"
              data-name="{{ meal.name }}"
              data-calories="{{ meal.calories }}"
              data-protein="{{ meal.protein }}"
              data-carbs="{{ meal.carbs }}"
              data-fat="{{ meal.fat }}"
              data-image-url="{{ meal.image_url }}">
              <span class="text-lg">âœï¸</span>
              <span>Chá»‰nh sá»­a</span>
            </button>
            <button onclick="openModal('{{ meal._id }}')" 
                    class="flex-1 bg-gradient-to-r from-red-100 to-red-200 hover:from-red-200 hover:to-red-300 text-red-700 rounded-2xl py-3 font-bold transition-all duration-300 border-2 border-red-300 hover:border-red-400 hover:shadow-lg flex items-center justify-center gap-2">
              <span class="text-lg">ğŸ—‘ï¸</span>
              <span>XÃ³a</span>
            </button>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  
  <!-- Enhanced empty state -->
  {% if meals|length == 0 %}
  <div class="empty-state flex flex-col items-center justify-center py-20 text-gray-400">
    <div class="relative mb-8">
      <div class="text-9xl animate-bounce">ğŸ½ï¸</div>
      <div class="absolute -top-4 -right-4 text-4xl animate-pulse">âœ¨</div>
      <div class="absolute -bottom-2 -left-2 text-3xl animate-pulse delay-300">ğŸ”</div>
    </div>
    <h3 class="text-3xl font-bold mb-4 bg-gradient-to-r from-gray-400 to-gray-600 bg-clip-text text-transparent">ChÆ°a cÃ³ mÃ³n Äƒn nÃ o</h3>
    <p class="text-xl mb-8 text-center max-w-md">HÃ£y thÃªm mÃ³n Äƒn Ä‘áº§u tiÃªn cá»§a báº¡n Ä‘á»ƒ báº¯t Ä‘áº§u hÃ nh trÃ¬nh khÃ¡m phÃ¡ áº©m thá»±c!</p>
    <button onclick="openAddMealModal()" class="bg-gradient-to-r from-pink-500 to-purple-500 hover:from-purple-500 hover:to-pink-500 text-white px-8 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 flex items-center gap-3">
      <span class="text-2xl">â•</span>
      <span>ThÃªm mÃ³n Äƒn Ä‘áº§u tiÃªn</span>
    </button>
  </div>
  {% endif %}
</div>

<style>
/* Enhanced Meal Cards Styles vá»›i responsive tá»‘i Æ°u */
.meals-container {
  animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Enhanced meal card animations */
.meal-card {
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  will-change: transform;
}

.meal-card:hover {
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.15),
    0 0 0 1px rgba(255, 192, 203, 0.3),
    0 0 30px rgba(236, 72, 153, 0.2);
}

/* Enhanced floating animations */
.meals-container .meal-card:nth-child(6n+1) {
  animation: float 4s ease-in-out infinite;
}

.meals-container .meal-card:nth-child(6n+2) {
  animation: float 4s ease-in-out infinite reverse;
  animation-delay: 0.5s;
}

.meals-container .meal-card:nth-child(6n+3) {
  animation: float 4s ease-in-out infinite;
  animation-delay: 1s;
}

.meals-container .meal-card:nth-child(6n+4) {
  animation: float 4s ease-in-out infinite reverse;
  animation-delay: 1.5s;
}

.meals-container .meal-card:nth-child(6n+5) {
  animation: float 4s ease-in-out infinite;
  animation-delay: 2s;
}

.meals-container .meal-card:nth-child(6n) {
  animation: float 4s ease-in-out infinite reverse;
  animation-delay: 2.5s;
}

@keyframes float {
  0%, 100% { 
    transform: translateY(0px) rotate(0deg); 
  }
  25% { 
    transform: translateY(-8px) rotate(0.5deg); 
  }
  50% { 
    transform: translateY(-4px) rotate(0deg); 
  }
  75% { 
    transform: translateY(-6px) rotate(-0.5deg); 
  }
}

/* Enhanced nutrition badges */
.nutrition-badge {
  position: relative;
  overflow: hidden;
}

.nutrition-badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.5s ease;
}

.nutrition-badge:hover::before {
  left: 100%;
}

/* Enhanced action buttons */
.action-btn {
  position: relative;
  overflow: hidden;
}

.action-btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.3s ease;
}

.action-btn:hover::before {
  width: 120%;
  height: 120%;
}

/* Enhanced search form */
.search-input {
  position: relative;
}

.search-input:focus {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
  transform: scale(1.02);
}

/* Enhanced stats cards */
.stats-card {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transform: translateX(-100%);
  transition: transform 0.6s ease;
}

.stats-card:hover::before {
  transform: translateX(100%);
}

.stats-card:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

/* Enhanced empty state */
.empty-state {
  animation: fadeIn 1s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Enhanced meal title */
.meal-title {
  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  transition: all 0.3s ease;
}

.group:hover .meal-title {
  background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Mobile optimizations - khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n responsive */
@media (max-width: 640px) {
  .meal-card {
    border-radius: 1.5rem;
    margin-bottom: 1rem;
  }
  
  .meal-card:hover {
    transform: translateY(-2px) scale(1.02);
  }
  
  .nutrition-grid {
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
  }
  
  .nutrition-badge {
    padding: 0.75rem;
    border-radius: 1rem;
  }
  
  .stats-card {
    padding: 1rem;
    border-radius: 1rem;
  }
  
  .action-btn {
    padding: 0.75rem;
  }
  
  /* Tá»‘i Æ°u animation cho mobile */
  .meals-container .meal-card {
    animation: none;
  }
  
  .meal-card:hover {
    animation: none;
  }
}

/* Tablet optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  .meals-container {
    padding: 0 1rem;
  }
  
  .meal-card {
    border-radius: 2rem;
  }
  
  .nutrition-grid {
    gap: 0.75rem;
  }
}

/* Desktop enhancements */
@media (min-width: 1025px) {
  .meal-card {
    border-radius: 2rem;
  }
  
  .nutrition-grid {
    gap: 1rem;
  }
  
  .stats-card:hover {
    transform: translateY(-6px) scale(1.08);
  }
}

/* Enhanced performance optimizations */
.meal-card img {
  will-change: transform;
}

.nutrition-badge,
.action-btn,
.stats-card {
  will-change: transform, box-shadow;
}

/* Dark mode support preparation */
@media (prefers-color-scheme: dark) {
  .meal-card {
    background: rgba(255, 255, 255, 0.95);
  }
  
  .nutrition-badge {
    backdrop-filter: blur(10px);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .meal-card,
  .nutrition-badge,
  .action-btn,
  .stats-card {
    animation: none;
    transition: none;
  }
  
  .meal-card:hover {
    transform: none;
  }
}

/* Loading skeleton improvements */
.image-loading {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Enhanced glassmorphism effects */
.glass-enhanced {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .meal-card {
    border: 3px solid #000;
  }
  
  .nutrition-badge {
    border-width: 2px;
  }
}
</style>
<!-- Logs and Analytics View -->
<div id="logView" class="hidden">
  <!-- Enhanced Header vá»›i gradient vÃ  animation -->
  <div class="bg-gradient-to-br from-emerald-50 via-blue-50 to-purple-50 rounded-3xl p-8 mb-8 border-2 border-emerald-200 shadow-xl relative overflow-hidden">
    <!-- Background decorations -->
    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-emerald-200/30 to-transparent rounded-full -translate-y-16 translate-x-16"></div>
    <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-blue-200/30 to-transparent rounded-full translate-y-12 -translate-x-12"></div>
    
    <div class="relative z-10">
      <h2 class="text-4xl font-bold mb-4 flex items-center gap-4 bg-gradient-to-r from-emerald-600 via-blue-600 to-purple-600 bg-clip-text text-transparent">
        <span class="text-5xl animate-pulse drop-shadow-lg">ğŸ“Š</span> 
        <div class="flex flex-col">
          <span>Nháº­t kÃ½ & PhÃ¢n tÃ­ch</span>
          <span class="text-lg font-normal text-gray-500">Theo dÃµi hÃ nh trÃ¬nh cá»§a báº¡n</span>
        </div>
      </h2>
      
      <!-- Quick Stats Cards -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mt-6">
        <div class="stats-card bg-gradient-to-br from-pink-100 to-pink-200 rounded-2xl p-4 border-2 border-pink-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-pink-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 text-center">
            <div class="text-2xl font-bold text-pink-600 mb-1 group-hover:scale-110 transition-transform">{{ summary.total_calories|default(0)|round|int }}</div>
            <div class="text-xs text-pink-700 font-medium flex items-center justify-center gap-1">
              <span class="text-sm">ğŸ”¥</span>
              Calories hÃ´m nay
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-green-100 to-green-200 rounded-2xl p-4 border-2 border-green-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-green-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 text-center">
            <div class="text-2xl font-bold text-green-600 mb-1 group-hover:scale-110 transition-transform">{{ summary.total_protein|default(0)|round(1) }}g</div>
            <div class="text-xs text-green-700 font-medium flex items-center justify-center gap-1">
              <span class="text-sm">ğŸ’ª</span>
              Protein
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-2xl p-4 border-2 border-yellow-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 text-center">
            <div class="text-2xl font-bold text-yellow-600 mb-1 group-hover:scale-110 transition-transform">{{ summary.total_carbs|default(0)|round(1) }}g</div>
            <div class="text-xs text-yellow-700 font-medium flex items-center justify-center gap-1">
              <span class="text-sm">ğŸ</span>
              Carbs
            </div>
          </div>
        </div>
        
        <div class="stats-card bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl p-4 border-2 border-purple-300 relative overflow-hidden group cursor-pointer">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-400/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 text-center">
            <div class="text-2xl font-bold text-purple-600 mb-1 group-hover:scale-110 transition-transform">{{ summary.total_fat|default(0)|round(1) }}g</div>
            <div class="text-xs text-purple-700 font-medium flex items-center justify-center gap-1">
              <span class="text-sm">ğŸ¥‘</span>
              Fat
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Today's Log Section -->
  <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl shadow-xl p-8 mb-8 border-2 border-blue-200 relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-blue-200/20 to-transparent rounded-full -translate-y-20 translate-x-20"></div>
    
    <div class="relative z-10">
      <h2 class="text-3xl font-extrabold mb-6 flex items-center gap-3 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
        <span class="text-4xl animate-bounce">ğŸ—“ï¸</span> 
        <span>Nháº­t kÃ½ hÃ´m nay</span>
      </h2>
      
      <!-- Enhanced Table Container -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden border-2 border-blue-100">
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white">
              <tr>
                <th class="px-6 py-4 text-center font-bold text-base border-r border-blue-400">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ½ï¸</span>
                    <span>MÃ³n Äƒn</span>
                  </div>
                </th>
                <th class="px-6 py-4 text-center font-bold text-base border-r border-blue-400">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ“Š</span>
                    <span>Sá»‘ lÆ°á»£ng</span>
                  </div>
                </th>
                <th class="px-6 py-4 text-center font-bold text-base border-r border-blue-400">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ”¥</span>
                    <span>Calories</span>
                  </div>
                </th>
                <th class="px-6 py-4 text-center font-bold text-base border-r border-blue-400">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ’ª</span>
                    <span>Protein</span>
                  </div>
                </th>
                <th class="px-6 py-4 text-center font-bold text-base border-r border-blue-400">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ</span>
                    <span>Carbs</span>
                  </div>
                </th>
                <th class="px-6 py-4 text-center font-bold text-base">
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-lg">ğŸ¥‘</span>
                    <span>Fat</span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-blue-100">
              {% for log in logs %}
              <tr class="group hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-300">
                <td class="px-6 py-4 text-center font-bold text-blue-700 group-hover:text-blue-800 transition-colors">
                  <div class="flex items-center justify-center gap-2">
                    <span class="w-2 h-2 bg-blue-400 rounded-full group-hover:bg-blue-600 transition-colors"></span>
                    {{ log.meal.name }}
                  </div>
                </td>
                <td class="px-6 py-4 text-center font-semibold text-gray-700">
                  <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">
                    {{ ("%.2f"|format(log.quantity)).rstrip('0').rstrip('.') }}
                  </span>
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="bg-pink-100 text-pink-700 px-3 py-2 rounded-xl font-bold shadow-sm">
                    {{ ("%.0f"|format(log.meal.calories * log.quantity)) }}
                  </span>
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="bg-green-100 text-green-700 px-3 py-2 rounded-xl font-bold shadow-sm">
                    {{ ("%.1f"|format(log.meal.protein * log.quantity)) }}g
                  </span>
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="bg-yellow-100 text-yellow-700 px-3 py-2 rounded-xl font-bold shadow-sm">
                    {{ ("%.1f"|format(log.meal.carbs * log.quantity)) }}g
                  </span>
                </td>
                <td class="px-6 py-4 text-center">
                  <span class="bg-purple-100 text-purple-700 px-3 py-2 rounded-xl font-bold shadow-sm">
                    {{ ("%.1f"|format(log.meal.fat * log.quantity)) }}g
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        
        {% if logs|length == 0 %}
        <div class="text-center py-16 bg-gradient-to-br from-gray-50 to-blue-50">
          <div class="relative mb-6">
            <div class="text-8xl text-gray-300 animate-pulse">ğŸ“</div>
            <div class="absolute -top-2 -right-2 text-3xl animate-bounce">âœ¨</div>
          </div>
          <h3 class="text-2xl font-bold mb-3 text-gray-500">ChÆ°a cÃ³ ghi chÃ©p nÃ o hÃ´m nay</h3>
          <p class="text-gray-400 mb-6">HÃ£y báº¯t Ä‘áº§u ghi láº¡i nhá»¯ng gÃ¬ báº¡n Ä‘Ã£ Äƒn!</p>
          <button onclick="openLogMealModal()" class="bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-indigo-500 hover:to-blue-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center gap-2 mx-auto">
            <span class="text-xl">ğŸ“</span>
            <span>Ghi nháº­t kÃ½ ngay</span>
          </button>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Enhanced Analytics Section -->
  <div class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-3xl shadow-xl p-8 border-2 border-emerald-200 relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute bottom-0 right-0 w-36 h-36 bg-gradient-to-tl from-emerald-200/20 to-transparent rounded-full translate-y-18 translate-x-18"></div>
    
    <div class="relative z-10">
      <h2 class="text-3xl font-extrabold mb-8 flex items-center gap-3 bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
        <span class="text-4xl animate-pulse">ğŸ“Š</span> 
        <span>PhÃ¢n tÃ­ch dinh dÆ°á»¡ng hÃ´m nay</span>
      </h2>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Enhanced Nutrition Chart -->
        <div class="chart-container bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border-2 border-emerald-100 group relative overflow-hidden">
          <!-- Floating glow effect -->
          <div class="absolute inset-0 bg-gradient-to-br from-emerald-100/0 via-teal-100/0 to-cyan-100/0 group-hover:from-emerald-100/30 group-hover:via-teal-100/20 group-hover:to-cyan-100/30 transition-all duration-700 rounded-3xl pointer-events-none"></div>
          
          <div class="relative z-10">
            <h3 class="text-xl font-bold mb-6 text-center flex items-center justify-center gap-3 text-emerald-700">
              <span class="text-2xl">ğŸ“ˆ</span> 
              <span>Tá»•ng quan dinh dÆ°á»¡ng</span>
            </h3>
            
            <div class="chart-wrapper relative">
              <canvas id="nutritionChart" class="w-full h-64 group-hover:scale-105 transition-transform duration-500"></canvas>
            </div>
            
            <!-- Enhanced nutrition summary -->
            <div class="grid grid-cols-2 gap-4 mt-6">
              <div class="nutrition-summary-card bg-gradient-to-br from-pink-50 to-pink-100 p-4 rounded-2xl border-2 border-pink-200 text-center hover:scale-105 transition-transform duration-300">
                <div class="text-2xl font-bold text-pink-600 mb-1">{{ summary.total_calories|default(0)|round|int }}</div>
                <div class="text-sm text-pink-700 font-medium flex items-center justify-center gap-2">
                  <span class="text-lg">ğŸ”¥</span>
                  <span>Calories</span>
                </div>
              </div>
              
              <div class="nutrition-summary-card bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-2xl border-2 border-green-200 text-center hover:scale-105 transition-transform duration-300">
                <div class="text-2xl font-bold text-green-600 mb-1">{{ summary.total_protein|default(0)|round(1) }}</div>
                <div class="text-sm text-green-700 font-medium flex items-center justify-center gap-2">
                  <span class="text-lg">ğŸ’ª</span>
                  <span>Protein (g)</span>
                </div>
              </div>
              
              <div class="nutrition-summary-card bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-2xl border-2 border-yellow-200 text-center hover:scale-105 transition-transform duration-300">
                <div class="text-2xl font-bold text-yellow-600 mb-1">{{ summary.total_carbs|default(0)|round(1) }}</div>
                <div class="text-sm text-yellow-700 font-medium flex items-center justify-center gap-2">
                  <span class="text-lg">ğŸ</span>
                  <span>Carbs (g)</span>
                </div>
              </div>
              
              <div class="nutrition-summary-card bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-2xl border-2 border-purple-200 text-center hover:scale-105 transition-transform duration-300">
                <div class="text-2xl font-bold text-purple-600 mb-1">{{ summary.total_fat|default(0)|round(1) }}</div>
                <div class="text-sm text-purple-700 font-medium flex items-center justify-center gap-2">
                  <span class="text-lg">ğŸ¥‘</span>
                  <span>Fat (g)</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Macro Pie Chart -->
        <div class="chart-container bg-white p-8 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border-2 border-emerald-100 group relative overflow-hidden">
          <!-- Floating glow effect -->
          <div class="absolute inset-0 bg-gradient-to-br from-emerald-100/0 via-teal-100/0 to-cyan-100/0 group-hover:from-emerald-100/30 group-hover:via-teal-100/20 group-hover:to-cyan-100/30 transition-all duration-700 rounded-3xl pointer-events-none"></div>
          
          <div class="relative z-10">
            <h3 class="text-xl font-bold mb-6 text-center flex items-center justify-center gap-3 text-emerald-700">
              <span class="text-2xl">ğŸ¥—</span> 
              <span>PhÃ¢n bá»‘ Macronutrients</span>
            </h3>
            
            <div class="chart-wrapper flex justify-center items-center relative">
              <canvas id="macroPieChart" width="300" height="300" class="max-w-full max-h-80 group-hover:scale-105 transition-transform duration-500"></canvas>
            </div>
            
            <!-- Enhanced legend -->
            <div class="flex justify-center gap-6 mt-6 flex-wrap">
              <div class="legend-item flex items-center gap-2 bg-blue-50 px-4 py-2 rounded-xl border border-blue-200 hover:bg-blue-100 transition-colors">
                <span class="w-4 h-4 rounded-full bg-blue-500 shadow-sm"></span>
                <span class="text-sm font-bold text-blue-700">Protein</span>
              </div>
              <div class="legend-item flex items-center gap-2 bg-yellow-50 px-4 py-2 rounded-xl border border-yellow-200 hover:bg-yellow-100 transition-colors">
                <span class="w-4 h-4 rounded-full bg-yellow-500 shadow-sm"></span>
                <span class="text-sm font-bold text-yellow-700">Carbs</span>
              </div>
              <div class="legend-item flex items-center gap-2 bg-green-50 px-4 py-2 rounded-xl border border-green-200 hover:bg-green-100 transition-colors">
                <span class="w-4 h-4 rounded-full bg-green-500 shadow-sm"></span>
                <span class="text-sm font-bold text-green-700">Fat</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Enhanced Log View Styles vá»›i responsive tá»‘i Æ°u */
#logView {
  animation: fadeInUp 0.6s ease-out;
}

/* Enhanced chart containers */
.chart-container {
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  will-change: transform, box-shadow;
}

.chart-container:hover {
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.15),
    0 0 0 1px rgba(16, 185, 129, 0.3),
    0 0 30px rgba(16, 185, 129, 0.2);
}

/* Enhanced table styles */
#logView table {
  border-collapse: separate;
  border-spacing: 0;
}

#logView tbody tr {
  transition: all 0.3s ease;
}

#logView tbody tr:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
}

/* Enhanced nutrition summary cards */
.nutrition-summary-card {
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.nutrition-summary-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.5s ease;
}

.nutrition-summary-card:hover::before {
  left: 100%;
}

/* Enhanced legend items */
.legend-item {
  cursor: pointer;
  transition: all 0.3s ease;
}

.legend-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Chart wrapper enhancements */
.chart-wrapper {
  position: relative;
}

.chart-wrapper canvas {
  border-radius: 1rem;
  transition: transform 0.3s ease;
}

/* Enhanced animations */
@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
  }
  50% {
    box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
  }
}

.chart-container:hover {
  animation: pulse-glow 2s infinite;
}

/* Enhanced floating animations for stats cards */
.stats-card:nth-child(4n+1) {
  animation: float 3s ease-in-out infinite;
}

.stats-card:nth-child(4n+2) {
  animation: float 3s ease-in-out infinite reverse;
  animation-delay: 0.5s;
}

.stats-card:nth-child(4n+3) {
  animation: float 3s ease-in-out infinite;
  animation-delay: 1s;
}

.stats-card:nth-child(4n) {
  animation: float 3s ease-in-out infinite reverse;
  animation-delay: 1.5s;
}

/* Enhanced shimmer effect for cards */
.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transform: translateX(-100%);
  transition: transform 0.6s ease;
}

.stats-card:hover::before {
  transform: translateX(100%);
}

/* Mobile optimizations */
@media (max-width: 640px) {
  #logView .chart-container {
    padding: 1.5rem;
    border-radius: 1.5rem;
  }
  
  #logView .nutrition-summary-card {
    padding: 0.75rem;
    border-radius: 1rem;
  }
  
  #logView table {
    font-size: 0.875rem;
  }
  
  #logView th,
  #logView td {
    padding: 0.75rem 0.5rem;
  }
  
  .chart-wrapper canvas {
    max-height: 250px;
  }
  
  .legend-item {
    padding: 0.5rem 0.75rem;
    font-size: 0.75rem;
  }
  
  /* Táº¯t animation floating cho mobile */
  .stats-card {
    animation: none;
  }
  
  .chart-container:hover {
    animation: none;
    transform: none;
  }
}

/* Tablet optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  #logView .chart-container {
    padding: 2rem;
  }
  
  .chart-wrapper canvas {
    max-height: 280px;
  }
  
  .nutrition-summary-card {
    padding: 1rem;
  }
}

/* Desktop enhancements */
@media (min-width: 1025px) {
  #logView .chart-container:hover {
    transform: translateY(-4px) scale(1.02);
  }
  
  .nutrition-summary-card:hover {
    transform: translateY(-3px) scale(1.08);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }
  
  .stats-card:hover {
    transform: translateY(-6px) scale(1.08);
  }
}

/* Enhanced loading states */
.chart-loading {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: 1rem;
  height: 300px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  #logView .chart-container {
    border-width: 3px;
  }
  
  #logView .nutrition-summary-card {
    border-width: 3px;
  }
  
  #logView .stats-card {
    border-width: 3px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #logView .chart-container,
  #logView .nutrition-summary-card,
  #logView .stats-card,
  #logView .legend-item {
    animation: none;
    transition: none;
  }
  
  #logView .chart-container:hover,
  #logView .nutrition-summary-card:hover,
  #logView .stats-card:hover {
    transform: none;
  }
}

/* Enhanced dark mode preparation */
@media (prefers-color-scheme: dark) {
  #logView .chart-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
  }
}

/* Enhanced performance optimizations */
#logView .chart-container,
#logView .nutrition-summary-card,
#logView .stats-card {
  will-change: transform, box-shadow;
}

#logView canvas {
  will-change: transform;
}

/* Enhanced table responsiveness */
@media (max-width: 768px) {
  #logView .overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: #3b82f6 #e5e7eb;
  }
  
  #logView .overflow-x-auto::-webkit-scrollbar {
    height: 6px;
  }
  
  #logView .overflow-x-auto::-webkit-scrollbar-track {
    background: #e5e7eb;
    border-radius: 3px;
  }
  
  #logView .overflow-x-auto::-webkit-scrollbar-thumb {
    background: #3b82f6;
    border-radius: 3px;
  }
}

/* Enhanced badge animations */
.nutrition-summary-card:hover .text-2xl {
  animation: bounce 0.6s ease-in-out;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

/* Enhanced gradient effects */
.bg-gradient-to-br {
  background-size: 200% 200%;
  animation: gradient-shift 6s ease infinite;
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Table row hover enhancements */
#logView tbody tr:hover td span {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

#logView tbody tr td span {
  transition: all 0.3s ease;
  display: inline-block;
}
</style>

<div id="welcomeView" class="flex flex-col items-center justify-center min-h-[70vh] text-center text-gray-700 space-y-8 p-4 md:p-8">
  <!-- Enhanced Welcome Card -->
  <div class="bg-gradient-to-br from-pink-50 via-blue-50 to-purple-50 rounded-3xl p-8 md:p-12 shadow-2xl border-2 border-[#fbc3bc] relative overflow-hidden max-w-4xl w-full">
    <!-- Background decorations -->
    <div class="absolute top-0 right-0 w-32 h-32 md:w-40 md:h-40 bg-gradient-to-bl from-pink-200/30 to-transparent rounded-full -translate-y-16 translate-x-16"></div>
    <div class="absolute bottom-0 left-0 w-24 h-24 md:w-32 md:h-32 bg-gradient-to-tr from-blue-200/30 to-transparent rounded-full translate-y-12 -translate-x-12"></div>
    
    <div class="relative z-10">
      <!-- Welcome Image with enhanced styling -->
      <div class="relative mb-8">
        <div class="w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 mx-auto relative">
          <img src="/static/trangchu.png" alt="SmartCalories Logo" class="w-full h-full rounded-full shadow-2xl border-4 border-white animate-float" />
          <div class="absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-r from-green-400 to-blue-500 rounded-full animate-ping"></div>
        </div>
      </div>

      <!-- Enhanced Welcome Text -->
      <div class="space-y-6">
        <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-blue-600 bg-clip-text text-transparent leading-tight">
          ChÃ o má»«ng Ä‘áº¿n vá»›i<br class="sm:hidden" />
          <span class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl">SmartCalories!</span>
        </h1>
        
        <p class="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-600 max-w-3xl mx-auto leading-relaxed font-medium">
          HÃ£y chá»n má»™t má»¥c tá»« menu bÃªn trÃ¡i Ä‘á»ƒ báº¯t Ä‘áº§u quáº£n lÃ½ kháº©u pháº§n Äƒn cá»§a báº¡n.
        </p>
        
        <!-- Enhanced subtitle -->
        <p class="text-sm sm:text-base md:text-lg text-gray-500 max-w-2xl mx-auto italic">
          Theo dÃµi dinh dÆ°á»¡ng â€¢ PhÃ¢n tÃ­ch sá»©c khá»e â€¢ Äáº¡t má»¥c tiÃªu cá»§a báº¡n
        </p>
      </div>

      <!-- Quick Action Cards for better UX -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mt-10 max-w-4xl mx-auto">
        <!-- Meals Card -->
        <div class="quick-action-card bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border-2 border-pink-200 hover:border-pink-400 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer group" onclick="event.preventDefault(); switchView('meals');">
          <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">ğŸ½ï¸</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">Danh sÃ¡ch mÃ³n Äƒn</h3>
          <p class="text-sm text-gray-600">KhÃ¡m phÃ¡ vÃ  quáº£n lÃ½ mÃ³n Äƒn yÃªu thÃ­ch</p>
        </div>

        {% if user.role != 'admin' %}
        <!-- Analytics Card -->
        <div class="quick-action-card bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border-2 border-blue-200 hover:border-blue-400 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer group" onclick="event.preventDefault(); switchView('log');">
          <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">ğŸ“Š</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">PhÃ¢n tÃ­ch dinh dÆ°á»¡ng</h3>
          <p class="text-sm text-gray-600">Xem bÃ¡o cÃ¡o vÃ  thá»‘ng kÃª chi tiáº¿t</p>
        </div>

        <!-- Quick Log Card -->
        <div class="quick-action-card bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border-2 border-green-200 hover:border-green-400 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer group" onclick="event.preventDefault(); openLogMealModal();">
          <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">ğŸ“</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">Ghi nháº­t kÃ½</h3>
          <p class="text-sm text-gray-600">ThÃªm nhanh mÃ³n Äƒn vÃ o nháº­t kÃ½</p>
        </div>
        {% else %}
        <!-- Admin User Management Card -->
        <div class="quick-action-card bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border-2 border-purple-200 hover:border-purple-400 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer group" onclick="openUserModal()">
          <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">ğŸ‘¥</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">Quáº£n lÃ½ ngÆ°á»i dÃ¹ng</h3>
          <p class="text-sm text-gray-600">Xem vÃ  quáº£n lÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng</p>
        </div>

        <!-- Admin Activity Log Card -->
        <div class="quick-action-card bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border-2 border-orange-200 hover:border-orange-400 transition-all duration-300 hover:scale-105 hover:shadow-xl cursor-pointer group" onclick="openActivityLogModal()">
          <div class="text-4xl mb-3 group-hover:scale-110 transition-transform">ğŸ“œ</div>
          <h3 class="text-lg font-bold text-gray-800 mb-2">Nháº­t kÃ½ hoáº¡t Ä‘á»™ng</h3>
          <p class="text-sm text-gray-600">Theo dÃµi hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng</p>
        </div>
        {% endif %}
      </div>

      <!-- Additional Features Showcase -->
      <div class="mt-12 grid grid-cols-2 md:grid-cols-4 gap-4 max-w-3xl mx-auto">
        <div class="feature-highlight bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-pink-200 text-center">
          <div class="text-2xl mb-2">ğŸ¯</div>
          <h4 class="text-sm font-bold text-gray-800 mb-1">Äáº·t má»¥c tiÃªu</h4>
          <p class="text-xs text-gray-600">Theo dÃµi tiáº¿n trÃ¬nh dinh dÆ°á»¡ng</p>
        </div>
        
        <div class="feature-highlight bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-blue-200 text-center">
          <div class="text-2xl mb-2">ğŸ“ˆ</div>
          <h4 class="text-sm font-bold text-gray-800 mb-1">PhÃ¢n tÃ­ch</h4>
          <p class="text-xs text-gray-600">BÃ¡o cÃ¡o chi tiáº¿t vá» sá»©c khá»e</p>
        </div>
        
        <div class="feature-highlight bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-green-200 text-center">
          <div class="text-2xl mb-2">ğŸ¤–</div>
          <h4 class="text-sm font-bold text-gray-800 mb-1">AI Chatbot</h4>
          <p class="text-xs text-gray-600">Há»— trá»£ tÆ° váº¥n dinh dÆ°á»¡ng</p>
        </div>
        
        <div class="feature-highlight bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-purple-200 text-center">
          <div class="text-2xl mb-2">ğŸ“±</div>
          <h4 class="text-sm font-bold text-gray-800 mb-1">Responsive</h4>
          <p class="text-xs text-gray-600">Sá»­ dá»¥ng má»i thiáº¿t bá»‹</p>
        </div>
      </div>

      <!-- Welcome Message for User -->
      <div class="mt-8 p-4 md:p-6 bg-white/60 backdrop-blur-sm rounded-2xl border border-[#fbc3bc] max-w-2xl mx-auto">
        <p class="text-lg font-semibold text-gray-700 mb-2">Xin chÃ o, {{ fullname }}! ğŸ‘‹</p>
        <p class="text-gray-600">ChÃºc báº¡n cÃ³ má»™t ngÃ y tuyá»‡t vá»i vá»›i SmartCalories. HÃ£y báº¯t Ä‘áº§u hÃ nh trÃ¬nh quáº£n lÃ½ dinh dÆ°á»¡ng khoa há»c ngay hÃ´m nay!</p>
      </div>
    </div>
  </div>

  <!-- Additional Tips Section -->
  <div class="max-w-4xl w-full mt-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
      <div class="tip-card bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-pink-200 text-center">
        <div class="text-3xl md:text-4xl mb-3">ğŸ’¡</div>
        <h4 class="text-lg font-bold text-gray-800 mb-2">Máº¹o sá»­ dá»¥ng</h4>
        <p class="text-sm text-gray-600">Sá»­ dá»¥ng AI chatbot Ä‘á»ƒ tÃ¬m kiáº¿m thÃ´ng tin dinh dÆ°á»¡ng nhanh chÃ³ng</p>
      </div>
      
      <div class="tip-card bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-blue-200 text-center">
        <div class="text-3xl md:text-4xl mb-3">â­</div>
        <h4 class="text-lg font-bold text-gray-800 mb-2">Gá»£i Ã½</h4>
        <p class="text-sm text-gray-600">Äáº·t má»¥c tiÃªu dinh dÆ°á»¡ng hÃ ng ngÃ y Ä‘á»ƒ theo dÃµi tiáº¿n trÃ¬nh</p>
      </div>
      
      <div class="tip-card bg-white/70 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-green-200 text-center">
        <div class="text-3xl md:text-4xl mb-3">ğŸ†</div>
        <h4 class="text-lg font-bold text-gray-800 mb-2">ThÃ nh tá»±u</h4>
        <p class="text-sm text-gray-600">Duy trÃ¬ thÃ³i quen ghi chÃ©p Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c káº¿t quáº£ tá»‘t nháº¥t</p>
      </div>
    </div>
  </div>
</div>
<script>
window.addEventListener('popstate', function(event) {
  const params = new URLSearchParams(window.location.search);
  const view = params.get("view");
  
  if (view === "log") {
    switchView("log");
  } else if (view === "meals") {
    switchView("meals");
  } else {
    goHome();
  }
});
function handleSearchForm(event) {
  event.preventDefault();
  const searchValue = event.target.search.value;
  const newUrl = window.location.pathname + "?view=meals" + (searchValue ? "&search=" + encodeURIComponent(searchValue) : "");
  window.location.href = newUrl;
  return false;
}
</script>
<style>
/* Enhanced Welcome View Styles vá»›i responsive tá»‘i Æ°u */
#welcomeView {
  animation: fadeInUp 0.8s ease-out;
  background: linear-gradient(135deg, 
    rgba(251, 195, 188, 0.05) 0%, 
    rgba(147, 197, 253, 0.05) 25%, 
    rgba(196, 181, 253, 0.05) 50%, 
    rgba(251, 195, 188, 0.05) 75%, 
    rgba(147, 197, 253, 0.05) 100%);
  background-size: 400% 400%;
  animation: welcomeGradient 15s ease infinite, fadeInUp 0.8s ease-out;
}

@keyframes welcomeGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Enhanced quick action cards */
.quick-action-card {
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.quick-action-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.5s ease;
}

.quick-action-card:hover::before {
  left: 100%;
}

.quick-action-card:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
}

/* Feature highlights with hover effects */
.feature-highlight {
  transition: all 0.3s ease;
  cursor: pointer;
}

.feature-highlight:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  background: rgba(255, 255, 255, 0.8);
}

/* Tip cards with enhanced styling */
.tip-card {
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.tip-card::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transform: translateX(-100%);
  transition: transform 0.6s ease;
}

.tip-card:hover::after {
  transform: translateX(100%);
}

.tip-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  background: rgba(255, 255, 255, 0.9);
}

/* Enhanced floating animations for decorative elements */
#welcomeView .animate-bounce {
  animation: bounce 2s infinite;
}

#welcomeView .animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

#welcomeView .animate-ping {
  animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
}

/* Welcome image hover effect */
#welcomeView img:hover {
  filter: drop-shadow(0 10px 20px rgba(251, 195, 188, 0.4));
}

/* Enhanced text gradient animation */
#welcomeView h1 {
  background-size: 200% 200%;
  animation: textGradient 3s ease infinite;
}

@keyframes textGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Responsive Typography */
@media (max-width: 640px) {
  #welcomeView {
    min-h-[60vh];
    padding: 1rem;
  }
  
  #welcomeView .bg-gradient-to-br {
    padding: 1.5rem;
    border-radius: 1.5rem;
  }
  
  #welcomeView h1 {
    line-height: 1.2;
  }
  
  #welcomeView p {
    line-height: 1.5;
  }
  
  .quick-action-card {
    padding: 1rem;
    border-radius: 1rem;
  }
  
  .quick-action-card h3 {
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }
  
  .quick-action-card p {
    font-size: 0.875rem;
  }
  
  .feature-highlight {
    padding: 0.75rem;
    border-radius: 0.75rem;
  }
  
  .tip-card {
    padding: 1rem;
    border-radius: 1rem;
  }
  
  .tip-card h4 {
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }
  
  /* Disable complex animations on mobile for performance */
  .quick-action-card:hover {
    transform: translateY(-2px) scale(1.01);
  }
  
  .feature-highlight:hover,
  .tip-card:hover {
    transform: translateY(-1px);
  }
}

@media (max-width: 480px) {
  #welcomeView {
    space-y: 1.5rem;
    padding: 0.5rem;
  }
  
  #welcomeView .bg-gradient-to-br {
    padding: 1rem;
    border-radius: 1.25rem;
  }
  
  #welcomeView .space-y-6 {
    gap: 1rem;
  }
  
  .quick-action-card {
    padding: 0.875rem;
  }
  
  .feature-highlight {
    padding: 0.5rem;
  }
  
  .tip-card {
    padding: 0.875rem;
  }
  
  /* Stack quick actions vertically on very small screens */
  #welcomeView .sm\:grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  /* Reduce text sizes further */
  #welcomeView h1 {
    font-size: 1.5rem;
  }
  
  #welcomeView h1 span {
    font-size: 1.75rem;
  }
  
  #welcomeView p {
    font-size: 0.875rem;
  }
  
  .quick-action-card .text-4xl {
    font-size: 2rem;
  }
  
  .feature-highlight .text-2xl {
    font-size: 1.5rem;
  }
  
  .tip-card .text-3xl {
    font-size: 2rem;
  }
}

/* Tablet optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  #welcomeView {
    min-h-[65vh];
    padding: 2rem 1rem;
  }
  
  .quick-action-card {
    padding: 1.25rem;
  }
  
  .tip-card {
    padding: 1.25rem;
  }
}

/* Desktop enhancements */
@media (min-width: 1025px) {
  #welcomeView {
    min-h-[75vh];
  }
  
  .quick-action-card:hover {
    transform: translateY(-6px) scale(1.05);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  }
  
  .feature-highlight:hover {
    transform: translateY(-3px) scale(1.05);
  }
  
  .tip-card:hover {
    transform: translateY(-4px) scale(1.02);
  }
}

/* Enhanced loading animation */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Staggered animation for quick action cards */
.quick-action-card:nth-child(1) {
  animation: fadeInUp 0.8s ease-out 0.2s both;
}

.quick-action-card:nth-child(2) {
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

.quick-action-card:nth-child(3) {
  animation: fadeInUp 0.8s ease-out 0.6s both;
}

/* Staggered animation for feature highlights */
.feature-highlight:nth-child(1) {
  animation: fadeInUp 0.6s ease-out 0.8s both;
}

.feature-highlight:nth-child(2) {
  animation: fadeInUp 0.6s ease-out 0.9s both;
}

.feature-highlight:nth-child(3) {
  animation: fadeInUp 0.6s ease-out 1s both;
}

.feature-highlight:nth-child(4) {
  animation: fadeInUp 0.6s ease-out 1.1s both;
}

/* Staggered animation for tip cards */
.tip-card:nth-child(1) {
  animation: fadeInUp 0.6s ease-out 1.2s both;
}

.tip-card:nth-child(2) {
  animation: fadeInUp 0.6s ease-out 1.3s both;
}

.tip-card:nth-child(3) {
  animation: fadeInUp 0.6s ease-out 1.4s both;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  #welcomeView .quick-action-card,
  #welcomeView .feature-highlight,
  #welcomeView .tip-card {
    border-width: 3px;
  }
  
  #welcomeView .bg-gradient-to-br {
    border-width: 3px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #welcomeView,
  #welcomeView *,
  .quick-action-card,
  .feature-highlight,
  .tip-card {
    animation: none !important;
    transition: none !important;
  }
  
  .quick-action-card:hover,
  .feature-highlight:hover,
  .tip-card:hover {
    transform: none !important;
  }
}

/* Dark mode preparation */
@media (prefers-color-scheme: dark) {
  #welcomeView {
    background: linear-gradient(135deg, 
      rgba(31, 41, 55, 0.95) 0%, 
      rgba(17, 24, 39, 0.95) 50%, 
      rgba(31, 41, 55, 0.95) 100%);
  }
  
  #welcomeView .bg-gradient-to-br {
    background: linear-gradient(135deg, 
      rgba(55, 65, 81, 0.95) 0%, 
      rgba(31, 41, 55, 0.95) 50%, 
      rgba(17, 24, 39, 0.95) 100%);
    border-color: #4b5563;
  }
  
  #welcomeView .quick-action-card,
  #welcomeView .feature-highlight,
  #welcomeView .tip-card {
    background: rgba(55, 65, 81, 0.8);
    color: #f9fafb;
    border-color: #4b5563;
  }
}

/* Performance optimizations */
#welcomeView .quick-action-card,
#welcomeView .feature-highlight,
#welcomeView .tip-card,
#welcomeView img {
  will-change: transform;
}

/* Print styles */
@media print {
  #welcomeView {
    background: white !important;
    color: black !important;
  }
  
  #welcomeView .quick-action-card,
  #welcomeView .feature-highlight,
  #welcomeView .tip-card {
    background: white !important;
    color: black !important;
    border: 1px solid #000 !important;
  }
}

/* Enhanced accessibility */
.quick-action-card:focus,
.feature-highlight:focus,
.tip-card:focus {
  outline: 2px solid #fbc3bc;
  outline-offset: 2px;
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  .quick-action-card:active {
    transform: scale(0.98);
  }
  
  .feature-highlight:active,
  .tip-card:active {
    transform: scale(0.97);
  }
}

/* Ultra-wide screen optimizations */
@media (min-width: 1440px) {
  #welcomeView {
    max-width: 1200px;
    margin: 0 auto;
  }
}

/* Enhanced backdrop blur support */
@supports (backdrop-filter: blur()) {
  #welcomeView .backdrop-blur-sm {
    backdrop-filter: blur(4px);
  }
}

@supports not (backdrop-filter: blur()) {
  #welcomeView .backdrop-blur-sm {
    background: rgba(255, 255, 255, 0.9);
  }
}
</style>
      </section>
    </main>
<script>
  window.mealsData = {{ meals | tojson | safe }};
  window.logsData = {{ logs | tojson | safe }};
  window.summary = {{ summary | tojson | safe }};
  window.activitiesData = {{ activities | tojson | safe }};
</script>
    <!-- JS Script -->
    <script>
      const summary = {
        calories: {{ summary.total_calories | default(0) }},
        protein: {{ summary.total_protein | default(0) }},
        carbs: {{ summary.total_carbs | default(0) }},
        fat: {{ summary.total_fat | default(0) }},
      };

      function switchView(view) {
        document.getElementById("mealsView").classList.add("hidden");
        document.getElementById("logView").classList.add("hidden");
        document.getElementById(view + "View").classList.remove("hidden");
      }

      window.onload = () => {
    // áº¨n táº¥t cáº£ view ban Ä‘áº§u
    document.getElementById("mealsView").classList.add("hidden");
    document.getElementById("logView").classList.add("hidden");
  };

      new Chart(document.getElementById("nutritionChart"), {
  type: 'bar',
  data: {
    labels: ['Calories', 'Protein', 'Carbs', 'Fat'],
    datasets: [{
      label: 'Dinh dÆ°á»¡ng hÃ´m nay',
      data: [summary.calories, summary.protein, summary.carbs, summary.fat],
      backgroundColor: [
        'rgba(255,99,132,0.8)',  // Ä‘á»
        'rgba(54,162,235,0.8)',  // xanh dÆ°Æ¡ng
        'rgba(255,206,86,0.8)',  // vÃ ng
        'rgba(75,192,192,0.8)'   // xanh lÃ¡
      ],
      hoverBackgroundColor: [
        'rgba(255,99,132,1)',
        'rgba(54,162,235,1)',
        'rgba(255,206,86,1)',
        'rgba(75,192,192,1)'
      ],
      borderRadius: 12,
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: '#1f2937',
        titleFont: { weight: 'bold', size: 14 },
        bodyFont: { size: 13 },
        padding: 10,
        callbacks: {
          label: function(ctx) {
            return `${ctx.label}: ${ctx.parsed.y} ${ctx.label === 'Calories' ? 'kcal' : 'g'}`;
          }
        }
      }
    },
    scales: {
      x: {
        grid: { display: false },
        ticks: { font: { size: 16, weight: 'bold' }, color: '#374151' }
      },
      y: {
        beginAtZero: true,
        grid: { color: '#e5e7eb' },
        ticks: { font: { size: 14 }, color: '#4b5563' }
      }
    }
  }
});


  // Macro Pie Chart
  new Chart(document.getElementById("macroPieChart"), {
  type: 'doughnut',
  data: {
    labels: ['Protein', 'Carbs', 'Fat'],
    datasets: [{
      data: [summary.protein, summary.carbs, summary.fat],
      backgroundColor: [
        'rgba(59,130,246,0.9)', // xanh dÆ°Æ¡ng
        'rgba(253,224,71,0.9)', // vÃ ng
        'rgba(52,211,153,0.9)'  // xanh lÃ¡
      ],
      hoverOffset: 14,
      borderColor: ['#2563eb', '#ca8a04', '#059669'],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    cutout: '65%',
    plugins: {
      legend: {
        display: true,
        position: 'bottom',
        labels: {
          font: { size: 15, weight: 'bold' },
          color: '#374151'
        }
      },
      tooltip: {
        callbacks: {
          label: function(ctx) {
            const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
            const value = ctx.parsed;
            const percent = total ? ((value / total) * 100).toFixed(1) : 0;
            return `${ctx.label}: ${value}g (${percent}%)`;
          }
        }
      }
    }
  }
  
});

</script>
<!-- Modal Ghi Nháº­t KÃ½ -->
<div id="logMealModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden border-2 border-pink-200">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ“
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Ghi nháº­t kÃ½</h2>
          <p class="text-white/80 text-sm">ThÃªm mÃ³n Äƒn vÃ o nháº­t kÃ½ hÃ´m nay</p>
        </div>
      </div>
      <button type="button" onclick="closeLogMealModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Form Content -->
    <form action="/log-meal" method="POST" class="p-6 space-y-5 bg-gradient-to-b from-pink-50/50 to-white">
      <!-- Chá»n mÃ³n Äƒn -->
      <div class="space-y-2">
        <label class="block font-semibold text-gray-700 flex items-center gap-2">
          <span class="w-2 h-2 bg-pink-400 rounded-full"></span>
          Chá»n mÃ³n Äƒn 
          <span class="text-red-500 text-lg">*</span>
        </label>
        <div class="relative">
          <select name="meal_id" class="w-full border-2 border-pink-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-300/30 focus:border-pink-400 transition-all duration-300 font-medium text-gray-700 appearance-none cursor-pointer" required>
            <option value="" class="text-gray-400">-- Chá»n mÃ³n Äƒn --</option>
            {% for meal in meals %}
            <option value="{{ meal._id }}" class="py-2">{{ meal.name }}</option>
            {% endfor %}
          </select>
          <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
            <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Sá»‘ lÆ°á»£ng vÃ  NgÃ y -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="space-y-2">
          <label class="block font-semibold text-gray-700 flex items-center gap-2">
            <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
            Sá»‘ lÆ°á»£ng 
            <span class="text-red-500 text-lg">*</span>
          </label>
          <div class="relative">
            <input name="quantity" type="number" step="0.1" min="0.1" placeholder="VD: 1.5" class="w-full border-2 border-blue-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-300/30 focus:border-blue-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400 text-lg">
              ğŸ“Š
            </div>
          </div>
        </div>

        <div class="space-y-2">
          <label class="block font-semibold text-gray-700 flex items-center gap-2">
            <span class="w-2 h-2 bg-green-400 rounded-full"></span>
            NgÃ y 
            <span class="text-red-500 text-lg">*</span>
          </label>
          <div class="relative">
            <input name="date" type="date" value="{{ today }}" class="w-full border-2 border-green-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-green-300/30 focus:border-green-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400 text-lg">
              ğŸ“…
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4">
        <button type="button" onclick="closeLogMealModal()" class="w-full sm:w-auto order-2 sm:order-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-2xl font-semibold transition-all duration-200 border-2 border-gray-200 hover:border-gray-300">
          Huá»·
        </button>
        <button type="submit" class="w-full sm:w-auto order-1 sm:order-2 bg-[#fbc3bc] hover:bg-[#f7b2a8] text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 border-2 border-[#fbc3bc] hover:border-[#f7b2a8]">
          <span class="text-xl">ğŸ’¾</span> 
          <span>LÆ°u nháº­t kÃ½</span>
        </button>
      </div>
    </form>
  </div>
</div>
  <script>
    function openLogMealModal() {
      document.getElementById('logMealModal').classList.remove('hidden');
    }
    function closeLogMealModal() {
      document.getElementById('logMealModal').classList.add('hidden');
    }
  </script>
  <!-- Modal ThÃªm MÃ³n Ä‚n -->
<div id="addMealModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl mx-4 max-h-[95vh] overflow-hidden border-2 border-pink-200">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ½ï¸
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">ThÃªm mÃ³n Äƒn má»›i</h2>
          <p class="text-white/80 text-sm">Táº¡o mÃ³n Äƒn vá»›i thÃ´ng tin dinh dÆ°á»¡ng</p>
        </div>
      </div>
      <button type="button" onclick="closeAddMealModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Form Content -->
    <div class="overflow-y-auto max-h-[calc(95vh-100px)]">
      <form action="/add-meal" method="POST" class="p-6 space-y-6 bg-gradient-to-b from-pink-50/50 to-white">
        <!-- ThÃ´ng tin cÆ¡ báº£n -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-gray-700 flex items-center gap-2 pb-2 border-b border-pink-200">
            <span class="text-xl">ğŸ“‹</span>
            ThÃ´ng tin cÆ¡ báº£n
          </h3>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-pink-400 rounded-full"></span>
                TÃªn mÃ³n Äƒn 
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input name="name" type="text" placeholder="VD: CÆ¡m gÃ  Háº£i Nam" class="w-full border-2 border-pink-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-300/30 focus:border-pink-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-pink-400 text-lg">
                  ğŸ´
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                Link áº£nh (tuá»³ chá»n)
              </label>
              <div class="relative">
                <input name="image_url" type="url" placeholder="https://example.com/image.jpg" class="w-full border-2 border-purple-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-purple-300/30 focus:border-purple-400 transition-all duration-300 font-medium text-gray-700 pl-12">
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400 text-lg">
                  ğŸ–¼ï¸
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ThÃ´ng tin dinh dÆ°á»¡ng -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-gray-700 flex items-center gap-2 pb-2 border-b border-pink-200">
            <span class="text-xl">ğŸ¥—</span>
            ThÃ´ng tin dinh dÆ°á»¡ng
          </h3>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-red-400 rounded-full"></span>
                Calories 
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input name="calories" type="number" step="0.1" min="0" placeholder="250" class="w-full border-2 border-red-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-red-300/30 focus:border-red-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-red-400 text-lg">
                  ğŸ”¥
                </div>
              </div>
              <p class="text-xs text-gray-500 pl-4">kcal</p>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
                Protein 
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input name="protein" type="number" step="0.1" min="0" placeholder="25" class="w-full border-2 border-blue-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-300/30 focus:border-blue-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400 text-lg">
                  ğŸ’ª
                </div>
              </div>
              <p class="text-xs text-gray-500 pl-4">gram</p>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
                Carbs 
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input name="carbs" type="number" step="0.1" min="0" placeholder="30" class="w-full border-2 border-yellow-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-yellow-300/30 focus:border-yellow-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400 text-lg">
                  ğŸ
                </div>
              </div>
              <p class="text-xs text-gray-500 pl-4">gram</p>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                Fat 
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input name="fat" type="number" step="0.1" min="0" placeholder="10" class="w-full border-2 border-green-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-green-300/30 focus:border-green-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400 text-lg">
                  ğŸ¥‘
                </div>
              </div>
              <p class="text-xs text-gray-500 pl-4">gram</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-end gap-3 pt-6 border-t border-pink-200">
          <button type="button" onclick="closeAddMealModal()" class="w-full sm:w-auto order-2 sm:order-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-2xl font-semibold transition-all duration-200 border-2 border-gray-200 hover:border-gray-300">
            Huá»·
          </button>
          <button type="submit" class="w-full sm:w-auto order-1 sm:order-2 bg-[#fbc3bc] hover:bg-[#f7b2a8] text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 border-2 border-[#fbc3bc] hover:border-[#f7b2a8]">
            <span class="text-xl">â•</span> 
            <span>ThÃªm mÃ³n Äƒn</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<style>
/* Enhanced Modal Styles vá»›i responsive tá»‘i Æ°u */
#logMealModal, #addMealModal {
  backdrop-filter: blur(8px);
}

/* Custom select arrow cho cÃ¡c trÃ¬nh duyá»‡t */
select {
  background-image: none !important;
}

/* Enhanced input focus states */
#logMealModal input:focus,
#logMealModal select:focus,
#addMealModal input:focus,
#addMealModal select:focus {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Input vá»›i icon bÃªn trÃ¡i */
.relative input[class*="pl-12"] {
  padding-left: 3rem;
}

/* Enhanced button hover states */
#logMealModal button,
#addMealModal button {
  position: relative;
  overflow: hidden;
}

#logMealModal button:hover,
#addMealModal button:hover {
  transform: translateY(-1px);
}

/* Loading animation cho button submit */
#logMealModal button[type="submit"]:active,
#addMealModal button[type="submit"]:active {
  transform: scale(0.98);
}

/* Enhanced placeholder styles */
#logMealModal input::placeholder,
#logMealModal select option:first-child,
#addMealModal input::placeholder {
  color: #9ca3af;
  font-style: italic;
}

/* Custom scrollbar cho modal content */
#addMealModal .overflow-y-auto {
  scrollbar-width: thin;
  scrollbar-color: #fbc3bc #f3f4f6;
}

#addMealModal .overflow-y-auto::-webkit-scrollbar {
  width: 6px;
}

#addMealModal .overflow-y-auto::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 3px;
}

#addMealModal .overflow-y-auto::-webkit-scrollbar-thumb {
  background: #fbc3bc;
  border-radius: 3px;
}

/* Enhanced responsive styles */
@media (max-width: 640px) {
  #logMealModal .max-w-md,
  #addMealModal .max-w-2xl {
    max-width: calc(100vw - 2rem);
    margin: 0 1rem;
  }
  
  #logMealModal .px-6,
  #addMealModal .px-6 {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  #logMealModal .p-6,
  #addMealModal .p-6 {
    padding: 1rem;
  }
  
  #logMealModal .space-y-5,
  #addMealModal .space-y-6 {
    gap: 1rem;
  }
  
  #logMealModal input,
  #logMealModal select,
  #addMealModal input {
    padding: 0.875rem;
    padding-left: 2.5rem;
    font-size: 16px; /* Prevents zoom on iOS */
  }
  
  #logMealModal .pl-12,
  #addMealModal .pl-12 {
    padding-left: 2.5rem;
  }
  
  #logMealModal button,
  #addMealModal button {
    padding: 0.875rem 1.5rem;
    font-size: 0.875rem;
  }
  
  /* Icon adjustments for mobile */
  #logMealModal .absolute.left-4,
  #addMealModal .absolute.left-4 {
    left: 0.75rem;
  }
  
  /* Grid adjustments */
  #addMealModal .lg\:grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  #addMealModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 480px) {
  #logMealModal .max-w-md,
  #addMealModal .max-w-2xl {
    max-width: calc(100vw - 1rem);
    margin: 0 0.5rem;
  }
  
  #logMealModal .rounded-3xl,
  #addMealModal .rounded-3xl {
    border-radius: 1.5rem;
  }
  
  #logMealModal .rounded-2xl,
  #addMealModal .rounded-2xl {
    border-radius: 1rem;
  }
  
  #addMealModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr;
  }
  
  #logMealModal .text-xl,
  #addMealModal .text-xl {
    font-size: 1.125rem;
  }
  
  #logMealModal .text-lg,
  #addMealModal .text-lg {
    font-size: 1rem;
  }
}

/* Tablet specific optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  #addMealModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr 1fr;
  }
  
  #addMealModal .max-w-2xl {
    max-width: calc(100vw - 4rem);
  }
}

/* Enhanced form validation styles */
#logMealModal input:invalid:not(:focus):not(:placeholder-shown),
#logMealModal select:invalid:not(:focus),
#addMealModal input:invalid:not(:focus):not(:placeholder-shown) {
  border-color: #ef4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

#logMealModal input:valid:not(:focus):not(:placeholder-shown),
#logMealModal select:valid:not(:focus),
#addMealModal input:valid:not(:focus):not(:placeholder-shown) {
  border-color: #10b981;
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

/* Enhanced loading states */
#logMealModal .loading,
#addMealModal .loading {
  opacity: 0.7;
  pointer-events: none;
}

#logMealModal .loading button[type="submit"],
#addMealModal .loading button[type="submit"] {
  position: relative;
}

#logMealModal .loading button[type="submit"]:after,
#addMealModal .loading button[type="submit"]:after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  margin: -10px 0 0 -10px;
  border: 2px solid transparent;
  border-top: 2px solid #ffffff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Enhanced accessibility */
#logMealModal [role="button"],
#addMealModal [role="button"] {
  cursor: pointer;
}

#logMealModal input:focus,
#logMealModal select:focus,
#addMealModal input:focus {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

/* Enhanced animation for modal appearance */
#logMealModal.show,
#addMealModal.show {
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Enhanced backdrop */
#logMealModal::backdrop,
#addMealModal::backdrop {
  backdrop-filter: blur(8px);
  background: rgba(0, 0, 0, 0.5);
}

/* Print styles */
@media print {
  #logMealModal,
  #addMealModal {
    display: none !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  #logMealModal input,
  #logMealModal select,
  #addMealModal input {
    border-width: 3px;
  }
  
  #logMealModal button,
  #addMealModal button {
    border-width: 3px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #logMealModal,
  #addMealModal,
  #logMealModal *,
  #addMealModal * {
    animation: none !important;
    transition: none !important;
  }
}

/* Dark mode preparation */
@media (prefers-color-scheme: dark) {
  #logMealModal .bg-white,
  #addMealModal .bg-white {
    background: #1f2937;
    color: #f9fafb;
  }
  
  #logMealModal input,
  #logMealModal select,
  #addMealModal input {
    background: #374151;
    color: #f9fafb;
    border-color: #4b5563;
  }
}
</style>
  <script>
    function openAddMealModal() {
      document.getElementById('addMealModal').classList.remove('hidden');
    }
    function closeAddMealModal() {
      document.getElementById('addMealModal').classList.add('hidden');
    }
  </script>
<!-- Modal Sá»­a MÃ³n Ä‚n -->
<div id="editMealModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-xl w-full max-w-xl overflow-hidden border border-blue-100">
    <div class="bg-[#fbc3bc] px-6 py-4 flex items-center justify-between border-b border-blue-200">
      <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
        âœï¸ Sá»­a mÃ³n Äƒn
      </h2>
      <button type="button" onclick="closeEditMealModal()" class="text-2xl font-bold text-gray-700 hover:text-red-500 transition">&times;</button>
    </div>
    <form id="editMealForm" method="POST" class="bg-blue-50 p-6 space-y-6">
      <input type="hidden" name="meal_id" id="editMealId" />
      
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="editName" class="block mb-1 font-semibold text-gray-700">TÃªn mÃ³n *</label>
          <input name="name" id="editName" class="w-full border border-blue-200 p-3 rounded-lg bg-white focus:ring-2 focus:ring-blue-300" required>
        </div>
        <div>
          <label for="editImageUrl" class="block mb-1 font-semibold text-gray-700">Link áº£nh (tuá»³ chá»n)</label>
          <input name="image_url" id="editImageUrl" type="url" class="w-full border border-pink-200 p-3 rounded-lg bg-white focus:ring-2 focus:ring-pink-300">
        </div>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <div>
          <label for="editCalories" class="block mb-1 font-medium text-gray-700">Calories *</label>
          <input type="number" step="any" id="editCalories" name="calories" class="w-full border border-blue-200 p-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-300" required>
        </div>
        <div>
          <label for="editProtein" class="block mb-1 font-medium text-gray-700">Protein *</label>
          <input type="number" step="any" id="editProtein" name="protein" class="w-full border border-blue-200 p-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-300" required>
        </div>
        <div>
          <label for="editCarbs" class="block mb-1 font-medium text-gray-700">Carbs *</label>
          <input type="number" step="any" id="editCarbs" name="carbs" class="w-full border border-blue-200 p-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-300" required>
        </div>
        <div>
          <label for="editFat" class="block mb-1 font-medium text-gray-700">Fat *</label>
          <input type="number" step="any" id="editFat" name="fat" class="w-full border border-blue-200 p-2 rounded-lg bg-white focus:ring-2 focus:ring-blue-300" required>
        </div>
      </div>

      <div class="flex justify-end gap-3 pt-2">
        <button type="button" onclick="closeEditMealModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold">Huá»·</button>
        <button type="submit" class="bg-[#fbc3bc] px-6 py-4 flex items-center hover:bg-pink-300 text-white px-6 py-2 rounded-lg font-bold shadow">LÆ°u</button>
      </div>
    </form>
  </div>
</div>

  <script>
    function openEditMealModal(meal) {
      document.getElementById('editMealId').value = meal._id;
      document.getElementById('editName').value = meal.name;
      document.getElementById('editCalories').value = meal.calories;
      document.getElementById('editProtein').value = meal.protein;
      document.getElementById('editCarbs').value = meal.carbs;
      document.getElementById('editFat').value = meal.fat;
      document.getElementById('editImageUrl').value = meal.image_url || ""; 
      document.getElementById('editMealForm').action = '/edit-meal/' + meal._id;
      document.getElementById('editMealModal').classList.remove('hidden');
    }
    document.querySelectorAll('.editMealBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const meal = {
          _id: btn.dataset.id,
          name: btn.dataset.name,
          calories: btn.dataset.calories,
          protein: btn.dataset.protein,
          carbs: btn.dataset.carbs,
          fat: btn.dataset.fat,
          image_url: btn.dataset.imageUrl || ""
    };
    openEditMealModal(meal);
  });
});
    function closeEditMealModal() {
      document.getElementById('editMealModal').classList.add('hidden');
    }
  </script>
  <!-- Modal xÃ¡c nháº­n xoÃ¡ -->
  <div id="deleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm">
      <h2 class="text-xl font-semibold mb-4">ğŸ—‘ï¸ XÃ¡c nháº­n xoÃ¡</h2>
      <p class="text-gray-700 mb-4">Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xoÃ¡ mÃ³n Äƒn nÃ y?</p>
      <div class="flex justify-end gap-3">
        <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded">Huá»·</button>
        <form id="confirmDeleteForm" method="POST">
          <button type="submit" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">XoÃ¡</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function openModal(mealId) {
      const modal = document.getElementById("deleteModal");
      const form = document.getElementById("confirmDeleteForm");
      form.action = "/delete-meal/" + mealId;
      modal.classList.remove("hidden");
    }
    function closeModal() {
      document.getElementById("deleteModal").classList.add("hidden");
    }
  </script>
<!-- Modal Gá»£i Ã½ mÃ³n Äƒn -->
<div id="suggestModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-auto max-h-[95vh] p-0 flex flex-col overflow-y-auto border-2 border-pink-200">
    <div class="bg-[#fbc3bc] px-6 py-4 flex items-center justify-between border-b border-blue-200">
      <h2 class="text-2xl font-bold text-pink-700 flex items-center gap-2">
        ğŸ¥— Gá»£i Ã½ mÃ³n Äƒn & Äáº·t má»¥c tiÃªu
      </h2>
      <button onclick="closeSuggestModal()" class="text-pink-700 hover:text-red-400 text-3xl font-bold transition">&times;</button>
    </div>
    <div class="p-6 space-y-4">
      <!-- Form Ä‘áº·t má»¥c tiÃªu -->
      <form method="post" action="/set-goals"
        class="flex flex-col sm:flex-row sm:items-end gap-2 mb-2 bg-white p-3 rounded-xl shadow w-full"
        id="goalsForm"
        onsubmit="return submitGoalsForm(event)">
        <div class="flex-1 min-w-0">
          <label class="block text-xs font-bold mb-1 text-blue-700">Calories</label>
          <input type="number" name="calories" value="0" min="0" class="border-2 border-blue-200 rounded-lg px-2 py-1 w-full text-base font-semibold bg-blue-50 focus:ring-2 focus:ring-blue-400 transition" required />
        </div>
        <div class="flex-1 min-w-0">
          <label class="block text-xs font-bold mb-1 text-blue-700">Protein</label>
          <input type="number" name="protein" value="0" min="0" class="border-2 border-blue-200 rounded-lg px-2 py-1 w-full text-base font-semibold bg-green-50 focus:ring-2 focus:ring-blue-400 transition" required />
        </div>
        <div class="flex-1 min-w-0">
          <label class="block text-xs font-bold mb-1 text-blue-700">Carbs</label>
          <input type="number" name="carbs" value="0" min="0" class="border-2 border-blue-200 rounded-lg px-2 py-1 w-full text-base font-semibold bg-yellow-50 focus:ring-2 focus:ring-blue-400 transition" required />
        </div>
        <div class="flex-1 min-w-0">
          <label class="block text-xs font-bold mb-1 text-blue-700">Fat</label>
          <input type="number" name="fat" value="0" min="0" class="border-2 border-blue-200 rounded-lg px-2 py-1 w-full text-base font-semibold bg-pink-50 focus:ring-2 focus:ring-blue-400 transition" required />
        </div>
        <button type="submit" class="bg-pink-200 text-pink-800 px-4 py-2 rounded-xl font-bold text-base shadow hover:bg-pink-300 transition w-full sm:w-auto mt-2 sm:mt-0">LÆ°u</button>
      </form>
      <!-- ThÃ´ng bÃ¡o lÆ°á»£ng cÃ²n thiáº¿u -->
      <div class="flex flex-wrap gap-2 text-base font-semibold">
        <div class="bg-pink-100 px-3 py-1 rounded-lg flex items-center gap-1">
          <span class="text-pink-600">ğŸ”¥</span>
          <span id="missingCalories" class="text-pink-600">Calories: {{ "%.0f"|format(missing.calories) }}</span>
        </div>
        <div class="bg-blue-100 px-3 py-1 rounded-lg flex items-center gap-1">
          <span class="text-blue-600">ğŸ’ª</span>
          <span id="missingProtein" class="text-blue-600">Protein: {{ "%.0f"|format(missing.protein) }}</span>
        </div>
        <div class="bg-yellow-100 px-3 py-1 rounded-lg flex items-center gap-1">
          <span class="text-yellow-600">ğŸ</span>
          <span id="missingCarbs" class="text-yellow-600">Carbs: {{ "%.0f"|format(missing.carbs) }}</span>
        </div>
        <div class="bg-green-100 px-3 py-1 rounded-lg flex items-center gap-1">
          <span class="text-green-600">ğŸ¥‘</span>
          <span id="missingFat" class="text-green-600">Fat: {{ "%.0f"|format(missing.fat) }}</span>
        </div>
      </div>
      <!-- Gá»£i Ã½ mÃ³n Äƒn -->
      <div class="overflow-y-auto space-y-4 pr-2" id="suggestedMealGroups" style="max-height: 40vh;"></div>
      <div class="text-xs text-gray-500 mt-2">* Gá»£i Ã½ dá»±a trÃªn cháº¥t cÃ²n thiáº¿u nhiá»u nháº¥t hÃ´m nay</div>
    </div>
  </div>
</div>
<script>
  function openSuggestModal() {
  document.getElementById('suggestModal').classList.remove('hidden');
  document.querySelector('input[name="calories"]').value = 0;
  document.querySelector('input[name="protein"]').value = 0;
  document.querySelector('input[name="carbs"]').value = 0;
  document.querySelector('input[name="fat"]').value = 0;
  // Reset cÃ¡c giÃ¡ trá»‹ "Äang thiáº¿u" vá» 0
  document.getElementById('missingCalories').textContent = "Calories: 0";
  document.getElementById('missingProtein').textContent = "Protein: 0";
  document.getElementById('missingCarbs').textContent = "Carbs: 0";
  document.getElementById('missingFat').textContent = "Fat: 0";
  // XoÃ¡ gá»£i Ã½ mÃ³n Äƒn cÅ©
  document.getElementById('suggestedMealGroups').innerHTML = "";
}
  // Náº¿u muá»‘n submit form khÃ´ng reload trang, cÃ³ thá»ƒ dÃ¹ng AJAX á»Ÿ Ä‘Ã¢y
</script>
<script>
  function openSuggestModal() {
    document.getElementById('suggestModal').classList.remove('hidden');
  }
  function closeSuggestModal() {
    document.getElementById('suggestModal').classList.add('hidden');
  }
</script>
<!-- Chatbot Floating Button & Modal -->
<style>
#chatbot-float-btn {
  position: fixed;
  bottom: 28px;
  right: 28px;
  z-index: 9999;
  background: #fbc3bc; /* MÃ u pastel giá»‘ng header */
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 60px; 
  height: 60px;
  box-shadow: 0 8px 25px rgba(251, 195, 188, 0.4);
  font-size: 2rem;
  display: flex; 
  align-items: center; 
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 3px solid rgba(255, 255, 255, 0.3);
}

#chatbot-float-btn:hover { 
  background: #f7b2a8;
  transform: translateY(-3px) scale(1.1);
  box-shadow: 0 12px 35px rgba(251, 195, 188, 0.6);
}

#chatbot-modal {
  position: fixed;
  bottom: 100px;
  right: 32px;
  width: 380px;
  max-width: 95vw;
  height: 500px;
  background: #fff;
  border-radius: 24px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  z-index: 9999;
  display: none;
  flex-direction: column;
  overflow: hidden;
  border: 3px solid #fbc3bc;
  animation: modalSlideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes modalSlideUp {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

#chatbot-modal.open { 
  display: flex; 
}

#chatbot-header {
  background: #fbc3bc; /* MÃ u pastel giá»‘ng header */
  color: #fff;
  padding: 20px 24px;
  font-weight: bold;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 3px solid rgba(255, 255, 255, 0.2);
  position: relative;
}

#chatbot-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  pointer-events: none;
}

#chatbot-header .header-content {
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  z-index: 1;
}

#chatbot-header .bot-avatar {
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  backdrop-filter: blur(10px);
}

#chatbot-header .header-text {
  display: flex;
  flex-direction: column;
}

#chatbot-header .header-title {
  font-size: 1.1rem;
  font-weight: 700;
  margin: 0;
}

#chatbot-header .header-status {
  font-size: 0.8rem;
  opacity: 0.9;
  margin: 2px 0 0 0;
}

#chatbot-close-btn {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: #fff;
  font-size: 1.8rem;
  cursor: pointer;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

#chatbot-close-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

#chatbot-messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background: linear-gradient(to bottom, #fff7f6, #ffffff);
  font-size: 0.95rem;
  line-height: 1.6;
  scrollbar-width: thin;
  scrollbar-color: #fbc3bc #f3f4f6;
}

#chatbot-messages::-webkit-scrollbar {
  width: 6px;
}

#chatbot-messages::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 3px;
}

#chatbot-messages::-webkit-scrollbar-thumb {
  background: #fbc3bc;
  border-radius: 3px;
}

.chatbot-msg {
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  animation: messageSlideIn 0.3s ease-out;
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chatbot-msg.user {
  align-items: flex-end;
}

.chatbot-msg .msg-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.chatbot-msg .avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid #fbc3bc;
  object-fit: cover;
}

.chatbot-msg.user .avatar {
  border-color: #a0e7a0;
}

.chatbot-msg .sender-name {
  font-size: 0.75rem;
  font-weight: 600;
  color: #666;
}

.chatbot-msg .bubble {
  font-size: 0.95rem; 
  padding: 12px 16px;
  border-radius: 18px;
  margin-bottom: 4px;
  word-break: break-word;
  white-space: pre-line;
  max-width: 280px;
  position: relative;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chatbot-msg.user .bubble {
  background: #a0e7a0; /* MÃ u pastel xanh lÃ¡ */
  color: #fff;
  border-bottom-right-radius: 6px;
  margin-left: auto;
}

.chatbot-msg.bot .bubble {
  background: #fbc3bc; /* MÃ u pastel há»“ng */
  color: #fff;
  border-bottom-left-radius: 6px;
}

.chatbot-msg .timestamp {
  font-size: 0.7rem;
  color: #999;
  margin-top: 4px;
  text-align: center;
}

.chatbot-msg.user .timestamp {
  text-align: right;
}

/* Loading animation */
.typing-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 12px 16px;
  background: #f0f0f0;
  border-radius: 18px;
  border-bottom-left-radius: 6px;
  max-width: 60px;
}

.typing-dot {
  width: 6px;
  height: 6px;
  background: #fbc3bc;
  border-radius: 50%;
  animation: typingAnimation 1.4s infinite;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typingAnimation {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.4;
  }
  30% {
    transform: translateY(-10px);
    opacity: 1;
  }
}

#chatbot-input-area {
  display: flex;
  border-top: 3px solid #fbc3bc;
  background: #fff;
  padding: 16px;
  gap: 12px;
  align-items: flex-end;
}

#chatbot-input {
  flex: 1;
  border: 2px solid #fbc3bc;
  border-radius: 20px;
  padding: 12px 16px;
  font-size: 0.95rem;
  outline: none;
  background: #fff;
  color: #333;
  resize: none;
  min-height: 20px;
  max-height: 80px;
  transition: all 0.3s ease;
  font-family: inherit;
}

#chatbot-input:focus {
  border-color: #f7b2a8;
  box-shadow: 0 0 0 3px rgba(251, 195, 188, 0.2);
  transform: translateY(-1px);
}

#chatbot-send-btn {
  background: #fbc3bc;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(251, 195, 188, 0.4);
}

#chatbot-send-btn:hover:not(:disabled) {
  background: #f7b2a8;
  transform: translateY(-2px) scale(1.1);
  box-shadow: 0 6px 18px rgba(251, 195, 188, 0.6);
}

#chatbot-send-btn:disabled { 
  opacity: 0.5; 
  cursor: not-allowed;
  transform: none;
}

/* Enhanced suggestions */
.suggestion-card {
  background: rgba(251, 195, 188, 0.1);
  border: 2px solid #fbc3bc;
  border-radius: 12px;
  padding: 12px;
  margin: 8px 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.suggestion-card:hover {
  background: rgba(251, 195, 188, 0.2);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(251, 195, 188, 0.3);
}

.suggestion-card .card-title {
  font-weight: 600;
  color: #333;
  margin-bottom: 4px;
}

.suggestion-card .card-content {
  font-size: 0.85rem;
  color: #666;
}

/* Meal info card */
.meal-info-card {
  background: linear-gradient(135deg, #fff7f6, #ffffff);
  border: 2px solid #fbc3bc;
  border-radius: 16px;
  padding: 16px;
  margin: 12px 0;
  box-shadow: 0 4px 12px rgba(251, 195, 188, 0.2);
}

.meal-info-card .meal-image {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 12px;
}

.meal-info-card .meal-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #333;
  margin-bottom: 8px;
}

.meal-info-card .nutrition-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 12px;
}

.meal-info-card .nutrition-item {
  background: rgba(251, 195, 188, 0.1);
  padding: 6px 10px;
  border-radius: 8px;
  text-align: center;
  font-size: 0.8rem;
}

.meal-info-card .nutrition-value {
  font-weight: 600;
  color: #333;
}

.meal-info-card .nutrition-label {
  color: #666;
  font-size: 0.7rem;
}

.confirm-buttons {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.confirm-btn {
  flex: 1;
  padding: 8px 16px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.85rem;
}

.confirm-btn.yes {
  background: #a0e7a0;
  color: #fff;
}

.confirm-btn.yes:hover {
  background: #8dd88d;
  transform: translateY(-1px);
}

.confirm-btn.no {
  background: #f0f0f0;
  color: #666;
}

.confirm-btn.no:hover {
  background: #e0e0e0;
}

/* Responsive design */
@media (max-width: 768px) {
  #chatbot-modal { 
    right: 16px; 
    bottom: 90px;
    width: calc(100vw - 32px);
    max-width: none;
    height: 70vh;
    max-height: 500px;
  }
  
  #chatbot-float-btn {
    bottom: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    font-size: 1.8rem;
  }
  
  #chatbot-header {
    padding: 16px 20px;
  }
  
  #chatbot-header .header-title {
    font-size: 1rem;
  }
  
  #chatbot-header .header-status {
    font-size: 0.75rem;
  }
  
  #chatbot-messages {
    padding: 16px;
  }
  
  .chatbot-msg .bubble {
    max-width: 240px;
    padding: 10px 14px;
    font-size: 0.9rem;
  }
  
  #chatbot-input-area {
    padding: 12px;
    gap: 8px;
  }
  
  #chatbot-input {
    font-size: 16px; /* Prevents zoom on iOS */
    padding: 10px 14px;
  }
  
  #chatbot-send-btn {
    width: 40px;
    height: 40px;
    font-size: 1.1rem;
  }
  
  .meal-info-card {
    padding: 12px;
  }
  
  .meal-info-card .meal-image {
    height: 100px;
  }
  
  .nutrition-grid {
    grid-template-columns: 1fr 1fr;
    gap: 6px;
  }
}

@media (max-width: 480px) {
  #chatbot-modal {
    right: 8px;
    bottom: 80px;
    width: calc(100vw - 16px);
    height: 65vh;
  }
  
  #chatbot-header {
    padding: 12px 16px;
  }
  
  #chatbot-header .bot-avatar {
    width: 32px;
    height: 32px;
    font-size: 1.2rem;
  }
  
  #chatbot-messages {
    padding: 12px;
  }
  
  .chatbot-msg .bubble {
    max-width: 200px;
    padding: 8px 12px;
    font-size: 0.85rem;
  }
  
  .meal-info-card .nutrition-grid {
    grid-template-columns: 1fr;
    gap: 4px;
  }
  
  .confirm-buttons {
    flex-direction: column;
    gap: 6px;
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  #chatbot-modal {
    background: #1f2937;
    border-color: #374151;
  }
  
  #chatbot-messages {
    background: linear-gradient(to bottom, #1f2937, #111827);
  }
  
  .chatbot-msg.bot .bubble {
    background: #374151;
    color: #f9fafb;
  }
  
  #chatbot-input {
    background: #374151;
    color: #f9fafb;
    border-color: #4b5563;
  }
  
  .meal-info-card {
    background: #374151;
    border-color: #4b5563;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  #chatbot-modal {
    border-width: 4px;
  }
  
  .chatbot-msg .bubble {
    border: 2px solid;
  }
  
  #chatbot-input {
    border-width: 3px;
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  #chatbot-modal,
  .chatbot-msg,
  #chatbot-float-btn,
  .suggestion-card,
  .confirm-btn {
    animation: none !important;
    transition: none !important;
  }
  
  .typing-dot {
    animation: none !important;
  }
}

/* Additional enhancements */
.quick-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin: 12px 0;
}

.quick-action-btn {
  background: rgba(251, 195, 188, 0.1);
  border: 1px solid #fbc3bc;
  color: #333;
  padding: 6px 12px;
  border-radius: 16px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.quick-action-btn:hover {
  background: #fbc3bc;
  color: #fff;
  transform: translateY(-1px);
}

.message-actions {
  display: flex;
  gap: 4px;
  margin-top: 4px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.chatbot-msg:hover .message-actions {
  opacity: 1;
}

.action-btn {
  background: none;
  border: none;
  color: #999;
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 4px;
  font-size: 0.7rem;
  transition: all 0.3s ease;
}

.action-btn:hover {
  background: rgba(251, 195, 188, 0.2);
  color: #fbc3bc;
}

/* Status indicators */
.status-indicator {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-left: 8px;
}

.status-online {
  background: #4ade80;
  box-shadow: 0 0 6px rgba(74, 222, 128, 0.5);
}

.status-thinking {
  background: #fbbf24;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
</style>

{% if user.role != 'admin' %}
<button id="chatbot-float-btn" title="Chat vá»›i SmartCalories">ğŸ’¬</button>
<div id="chatbot-modal">
  <div id="chatbot-header">
    <div class="header-content">
      <div class="bot-avatar">ğŸ¤–</div>
      <div class="header-text">
        <div class="header-title">SmartCalories AI</div>
        <div class="header-status">
          Trá»£ lÃ½ dinh dÆ°á»¡ng thÃ´ng minh
          <span class="status-indicator status-online"></span>
        </div>
      </div>
    </div>
    <button id="chatbot-close-btn">Ã—</button>
  </div>
  
  <div id="chatbot-messages"></div>
  
  <form id="chatbot-input-area" autocomplete="off">
    <textarea id="chatbot-input" placeholder="Há»i vá» mÃ³n Äƒn, dinh dÆ°á»¡ng, gá»£i Ã½ thá»±c Ä‘Æ¡n..." required rows="1"></textarea>
    <button id="chatbot-send-btn" type="submit">ğŸ“¤</button>
  </form>
</div>

<script>
const chatbotBtn = document.getElementById('chatbot-float-btn');
const chatbotModal = document.getElementById('chatbot-modal');
const chatbotClose = document.getElementById('chatbot-close-btn');
const chatbotMessages = document.getElementById('chatbot-messages');
const chatbotInput = document.getElementById('chatbot-input');
const chatbotSendBtn = document.getElementById('chatbot-send-btn');

let chatbotHistory = [
  {role: "system", content: "Báº¡n lÃ  trá»£ lÃ½ dinh dÆ°á»¡ng thÃ´ng minh SmartCalories."},
  {role: "assistant", content: "Xin chÃ o! ğŸ‘‹\n\nTÃ´i lÃ  trá»£ lÃ½ AI chuyÃªn vá» dinh dÆ°á»¡ng vÃ  sá»©c khá»e. TÃ´i cÃ³ thá»ƒ:\n\nğŸ” **TÃ¬m kiáº¿m thÃ´ng tin mÃ³n Äƒn** tá»« nhiá»u nguá»“n\nğŸ“Š **PhÃ¢n tÃ­ch dinh dÆ°á»¡ng** chi tiáº¿t\nğŸ’¡ **Gá»£i Ã½ thá»±c Ä‘Æ¡n** phÃ¹ há»£p\nâ• **ThÃªm mÃ³n Äƒn má»›i** vÃ o há»‡ thá»‘ng\nğŸƒ **TÆ° váº¥n hoáº¡t Ä‘á»™ng** thá»ƒ cháº¥t\n\nHÃ£y thá»­ há»i tÃ´i vá» mÃ³n Äƒn báº¡n quan tÃ¢m!"}
];

let pendingMeal = null;
let isTyping = false;

// Auto-resize textarea
chatbotInput.addEventListener('input', function() {
  this.style.height = '20px';
  this.style.height = Math.min(this.scrollHeight, 80) + 'px';
});

// Enter to send (Shift+Enter for new line)
chatbotInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    document.getElementById('chatbot-input-area').dispatchEvent(new Event('submit'));
  }
});

function getCurrentTime() {
  return new Date().toLocaleTimeString('vi-VN', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
}

function renderChatbotHistory() {
  chatbotMessages.innerHTML = '';
  chatbotHistory.forEach(msg => {
    if (msg.role === 'system') return;
    appendMsg(msg.role === 'assistant' ? 'bot' : 'user', msg.content, msg.timestamp);
  });
  chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
}

chatbotBtn.onclick = () => {
  if (chatbotModal.classList.contains('open')) {
    chatbotModal.classList.remove('open');
  } else {
    chatbotModal.classList.add('open');
    setTimeout(() => {
      renderChatbotHistory();
      chatbotInput.focus();
    }, 100);
  }
};

chatbotClose.onclick = () => chatbotModal.classList.remove('open');

function showTypingIndicator() {
  if (isTyping) return;
  isTyping = true;
  
  const typingMsg = document.createElement('div');
  typingMsg.className = 'chatbot-msg bot typing-message';
  typingMsg.innerHTML = `
    <div class="msg-header">
      <img src="/static/bot-avatar.png" alt="Bot" class="avatar" />
      <span class="sender-name">SmartCalories AI</span>
    </div>
    <div class="typing-indicator">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>
  `;
  
  chatbotMessages.appendChild(typingMsg);
  chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  
  // Update status
  document.querySelector('.status-indicator').className = 'status-indicator status-thinking';
}

function hideTypingIndicator() {
  isTyping = false;
  const typingMsg = document.querySelector('.typing-message');
  if (typingMsg) {
    typingMsg.remove();
  }
  // Update status
  document.querySelector('.status-indicator').className = 'status-indicator status-online';
}

function appendMsg(role, text, timestamp = null) {
  const msg = document.createElement('div');
  msg.className = 'chatbot-msg ' + (role === 'user' ? 'user' : 'bot');

  const msgTimestamp = timestamp || getCurrentTime();
  
  // Create message header
  const msgHeader = document.createElement('div');
  msgHeader.className = 'msg-header';
  
  const avatar = document.createElement('img');
  avatar.className = 'avatar';
  
  const senderName = document.createElement('span');
  senderName.className = 'sender-name';
  
  if (role === 'user') {
    avatar.src = "{{ user.avatar_url or '/static/default-avatar.png' }}";
    avatar.alt = 'User';
    senderName.textContent = '{{ fullname }}';
  } else {
    avatar.src = '/static/bot-avatar.png';
    avatar.alt = 'Bot';
    senderName.textContent = 'SmartCalories AI';
  }
  
  msgHeader.appendChild(avatar);
  msgHeader.appendChild(senderName);

  // Create message bubble
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  
  // Enhanced text processing
  let processedText = text
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/^\s*[-â€¢]\s+/gm, 'â€¢ ')
    .replace(/\n/g, "<br>");
    
  // Check for meal info pattern
  const mealInfoMatch = text.match(/MEAL_INFO:({.*})/);
  if (mealInfoMatch) {
    try {
      const mealData = JSON.parse(mealInfoMatch[1]);
      bubble.innerHTML = createMealCard(mealData);
    } catch (e) {
      bubble.innerHTML = processedText;
    }
  } else {
    bubble.innerHTML = processedText;
  }

  // Create timestamp
  const timestampEl = document.createElement('div');
  timestampEl.className = 'timestamp';
  timestampEl.textContent = msgTimestamp;

  // Create message actions (for bot messages)
  if (role === 'bot') {
    const actions = document.createElement('div');
    actions.className = 'message-actions';
    actions.innerHTML = `
      <button class="action-btn" onclick="copyMessage(this)" title="Sao chÃ©p">ğŸ“‹</button>
      <button class="action-btn" onclick="likeMessage(this)" title="Há»¯u Ã­ch">ğŸ‘</button>
    `;
    msg.appendChild(actions);
  }

  msg.appendChild(msgHeader);
  msg.appendChild(bubble);
  msg.appendChild(timestampEl);
  
  chatbotMessages.appendChild(msg);
  chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
}

function createMealCard(mealData) {
  const imageUrl = mealData.image_url || '/static/default-food.jpg';
  
  return `
    <div class="meal-info-card">
      <img src="${imageUrl}" alt="${mealData.name}" class="meal-image" onerror="this.src='/static/default-food.jpg'" />
      <div class="meal-title">${mealData.name}</div>
      <div class="nutrition-grid">
        <div class="nutrition-item">
          <div class="nutrition-value">${mealData.calories}</div>
          <div class="nutrition-label">Calories</div>
        </div>
        <div class="nutrition-item">
          <div class="nutrition-value">${mealData.protein}g</div>
          <div class="nutrition-label">Protein</div>
        </div>
        <div class="nutrition-item">
          <div class="nutrition-value">${mealData.carbs}g</div>
          <div class="nutrition-label">Carbs</div>
        </div>
        <div class="nutrition-item">
          <div class="nutrition-value">${mealData.fat}g</div>
          <div class="nutrition-label">Fat</div>
        </div>
      </div>
      <div class="confirm-buttons">
        <button class="confirm-btn yes" onclick="confirmAddMeal('${encodeURIComponent(JSON.stringify(mealData))}')">
          âœ… ThÃªm vÃ o danh sÃ¡ch
        </button>
        <button class="confirm-btn no" onclick="rejectAddMeal()">
          âŒ KhÃ´ng thÃªm
        </button>
      </div>
    </div>
  `;
}

// Enhanced message handling
document.getElementById('chatbot-input-area').onsubmit = async function(e) {
  e.preventDefault();
  const text = chatbotInput.value.trim();
  if (!text) return;

  chatbotHistory.push({role: "user", content: text, timestamp: getCurrentTime()});
  appendMsg('user', text);
  chatbotInput.value = '';
  chatbotInput.style.height = '20px';
  chatbotSendBtn.disabled = true;

  // Show typing indicator
  showTypingIndicator();

  try {
    const res = await fetch('/chatbot', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        messages: chatbotHistory,
        meals: window.mealsData || [],
        logs: window.logsData || [],
        summary: window.summary || {},
        activities: window.activitiesData || []
      }),
      credentials: 'same-origin'
    });

    const data = await res.json();
    hideTypingIndicator();
    
    const reply = data.reply || 'Xin lá»—i, tÃ´i chÆ°a cÃ³ cÃ¢u tráº£ lá»i.';
    
    // Store pending meal if exists
    if (data.meal_data) {
      pendingMeal = data.meal_data;
    }
    
    chatbotHistory.push({role: "assistant", content: reply, timestamp: getCurrentTime()});
    appendMsg('bot', reply);

  } catch (err) {
    hideTypingIndicator();
    appendMsg('bot', 'âŒ Lá»—i káº¿t ná»‘i Ä‘áº¿n mÃ¡y chá»§. Vui lÃ²ng thá»­ láº¡i sau.');
    console.error('Chatbot error:', err);
  }

  chatbotSendBtn.disabled = false;
  chatbotInput.focus();
};

// Enhanced meal confirmation
function confirmAddMeal(encodedMealData) {
  try {
    const mealData = JSON.parse(decodeURIComponent(encodedMealData));
    
    fetch('/add-meal-from-chatbot', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(mealData),
      credentials: 'same-origin'
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        appendMsg('bot', `âœ… ÄÃ£ thÃªm mÃ³n **${mealData.name}** vÃ o danh sÃ¡ch thÃ nh cÃ´ng!\n\nBáº¡n cÃ³ thá»ƒ tÃ¬m tháº¥y mÃ³n nÃ y trong danh sÃ¡ch mÃ³n Äƒn.`);
        
        // Update local meals data
        if (window.mealsData) {
          window.mealsData.push({
            ...mealData,
            _id: data.meal_id
          });
        }
      } else {
        appendMsg('bot', `âŒ CÃ³ lá»—i khi thÃªm mÃ³n Äƒn: ${data.message}`);
      }
    })
    .catch(err => {
      appendMsg('bot', 'âŒ Lá»—i káº¿t ná»‘i khi thÃªm mÃ³n Äƒn.');
      console.error('Add meal error:', err);
    });
    
  } catch (e) {
    appendMsg('bot', 'âŒ Lá»—i xá»­ lÃ½ dá»¯ liá»‡u mÃ³n Äƒn.');
    console.error('Parse meal data error:', e);
  }
}

function rejectAddMeal() {
  appendMsg('bot', 'ÄÃ£ há»§y viá»‡c thÃªm mÃ³n Äƒn. Báº¡n cÃ³ cáº§n tÃ´i tÃ¬m kiáº¿m mÃ³n Äƒn khÃ¡c khÃ´ng? ğŸ¤”');
  pendingMeal = null;
}

// Message actions
function copyMessage(btn) {
  const bubble = btn.closest('.chatbot-msg').querySelector('.bubble');
  const text = bubble.textContent || bubble.innerText;
  
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = 'âœ…';
      setTimeout(() => btn.textContent = 'ğŸ“‹', 1000);
    });
  }
}

function likeMessage(btn) {
  btn.textContent = 'ğŸ’–';
  btn.style.color = '#ff6b6b';
  setTimeout(() => {
    btn.textContent = 'ğŸ‘';
    btn.style.color = '';
  }, 1500);
}

// Quick actions on first load
function showQuickActions() {
  const quickActionsHtml = `
    <div class="quick-actions">
      <button class="quick-action-btn" onclick="sendQuickMessage('Gá»£i Ã½ mÃ³n Äƒn healthy')">ğŸ¥— MÃ³n Äƒn healthy</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('PhÃ¢n tÃ­ch dinh dÆ°á»¡ng hÃ´m nay')">ğŸ“Š PhÃ¢n tÃ­ch dinh dÆ°á»¡ng</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('TÃ¬m mÃ³n Äƒn phá»Ÿ')">ğŸœ TÃ¬m mÃ³n phá»Ÿ</button>
      <button class="quick-action-btn" onclick="sendQuickMessage('TÆ° váº¥n cháº¿ Ä‘á»™ Äƒn')">ğŸ’¡ TÆ° váº¥n Äƒn uá»‘ng</button>
    </div>
  `;
  
  const lastBotMsg = [...chatbotMessages.children].reverse().find(msg => msg.classList.contains('bot'));
  if (lastBotMsg) {
    lastBotMsg.querySelector('.bubble').innerHTML += quickActionsHtml;
  }
}

function sendQuickMessage(message) {
  chatbotInput.value = message;
  document.getElementById('chatbot-input-area').dispatchEvent(new Event('submit'));
}

// Initialize quick actions after first bot message
setTimeout(showQuickActions, 1000);

// Close modal when clicking outside
document.addEventListener('click', function(e) {
  if (!chatbotModal.contains(e.target) && !chatbotBtn.contains(e.target)) {
    chatbotModal.classList.remove('open');
  }
});

// Prevent modal close when clicking inside
chatbotModal.addEventListener('click', function(e) {
  e.stopPropagation();
});
</script>
{% endif %}
<style>
.sidebar.collapsed .w-full img {
  width: 2.5rem !important;
  height: 2.5rem !important;
}
.sidebar.collapsed {
  width: 4rem !important;
  padding-left: 0.5rem !important;
  padding-right: 0.5rem !important;
  overflow: hidden !important;
}
.sidebar.collapsed button[onclick*="toggleSidebar"] {
  left: 40px !important;
  right: auto !important;
}
  /* Khi sidebar bá»‹ collapse */
  #sidebar.collapsed {
    width: 4rem; /* w-16 */
  }
  #sidebar.collapsed .sidebar-text {
    display: none;
  }
  .sidebar-btn {
  @apply flex items-center gap-3 px-4 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-blue-400 to-green-400 shadow hover:from-green-400 hover:to-blue-400 hover:scale-105 transition-all duration-200;
  margin-bottom: 0.25rem;
  border: none;
  outline: none;
  cursor: pointer;
}
.sidebar-btn:active {
  @apply scale-95;
}
.sidebar-btn .sidebar-text {
  @apply transition-all duration-200;
}
.sidebar.collapsed .sidebar-text {
  display: none !important;
}
.sidebar.collapsed .sidebar-btn {
  justify-content: center;
  padding-left: 0.5rem;
  padding-right: 0.5rem;
}
.sidebar.collapsed {
  width: 4rem !important;
  padding-left: 0.5rem !important;
  padding-right: 0.5rem !important;
  overflow: hidden !important;
}
.sidebar.collapsed nav {
  display: block !important;
}

#sidebar.collapsed {
  width: 4rem !important;
  padding: 0.5rem 0.25rem !important;
  overflow: hidden !important;
  box-shadow: none;
}
#sidebar.collapsed .sidebar-text {
  display: none !important;
}
  .sidebar-btn {
    @apply flex items-center gap-3 px-4 py-3 rounded-xl text-white font-medium transition-all duration-200 ease-in-out hover:bg-blue-500/50 focus:outline-none;
  }
  .sidebar-btn.active {
    @apply bg-white text-blue-700 shadow-md font-semibold;
  }
  .sidebar-text {
    @apply whitespace-nowrap;
  }
@media (max-width: 640px) {
  #profileModal .bg-white {
    max-width: 98vw !important;
    padding: 0.5rem !important;
  }
  #profileForm {
    padding: 0 !important;
    max-width: 100vw !important;
  }
  #profileForm input,
  #profileForm select {
    font-size: 15px !important;
    padding: 0.5rem !important;
  }
}
.fe-bold { font-weight: bold; color: #FF6F61; }

  @media (max-width: 400px) {
    .text-3xl { font-size: 1.75rem; }
    .sm\:text-5xl { font-size: 2rem !important; }
    .rounded-xl, .rounded-2xl { border-radius: 1rem !important; }
    .sm\:text-lg { font-size: 1rem !important; }
    .sm\:px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
  }

</style>
<script>
function switchView(view) {
  // áº¨n táº¥t cáº£ view
  document.getElementById("welcomeView").classList.add("hidden");
  document.getElementById("mealsView").classList.add("hidden");
  document.getElementById("logView").classList.add("hidden");

  // Hiá»‡n view tÆ°Æ¡ng á»©ng
  document.getElementById(view + "View").classList.remove("hidden");

  // Cáº­p nháº­t tráº¡ng thÃ¡i active cho sidebar buttons
  document.querySelectorAll(".sidebar-btn").forEach(btn => {
    btn.classList.remove("bg-white", "text-blue-700", "font-semibold", "shadow-md");
    btn.classList.add("text-white");
  });
  
  const activeBtn = document.getElementById("btn-" + view);
  if (activeBtn) {
    activeBtn.classList.add("bg-white", "text-blue-700", "font-semibold", "shadow-md");
    activeBtn.classList.remove("text-white");
  }

  // ÄÃ³ng sidebar trÃªn mobile sau khi chá»n
  if (window.innerWidth < 768) {
    closeSidebar();
  }

  // Scroll to top
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  // NgÄƒn cháº·n reload trang báº±ng cÃ¡ch update URL mÃ  khÃ´ng reload
  if (history.pushState) {
    const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + "?view=" + view;
    window.history.pushState({path: newUrl}, '', newUrl);
  }
}

function goHome() {
  // áº¨n táº¥t cáº£ view khÃ¡c
  document.getElementById("mealsView").classList.add("hidden");
  document.getElementById("logView").classList.add("hidden");
  
  // Hiá»‡n welcome view
  document.getElementById("welcomeView").classList.remove("hidden");
  
  // XoÃ¡ tráº¡ng thÃ¡i active cá»§a táº¥t cáº£ sidebar buttons
  document.querySelectorAll(".sidebar-btn").forEach(btn => {
    btn.classList.remove("bg-white", "text-blue-700", "font-semibold", "shadow-md");
    btn.classList.add("text-white");
  });
  
  // Update URL vá» trang chá»§ mÃ  khÃ´ng reload
  if (history.pushState) {
    const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
    window.history.pushState({path: newUrl}, '', newUrl);
  }
  
  // Scroll to top
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
window.onload = () => {
  const params = new URLSearchParams(window.location.search);
  const view = params.get("view");

  // Äáº·t cá» Ä‘á»ƒ trÃ¡nh xá»­ lÃ½ láº·p láº¡i
  if (window.viewInitialized) return;
  window.viewInitialized = true;

  if (view === "log") {
    switchView("log");
  } else if (view === "meals") {
    switchView("meals");
  } else {
    // Hiá»‡n welcome view máº·c Ä‘á»‹nh
    goHome();
  }
};
</script>
<script>
function submitGoalsForm(event) {
  event.preventDefault();
  const form = document.getElementById('goalsForm');
  const formData = new FormData(form);

  fetch('/set-goals', {
    method: 'POST',
    body: formData,
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    // Cáº­p nháº­t lÆ°á»£ng cÃ²n thiáº¿u
    document.getElementById('missingCalories').textContent = "Calories: " + data.missing.calories;
    document.getElementById('missingProtein').textContent = "Protein: " + data.missing.protein;
    document.getElementById('missingCarbs').textContent = "Carbs: " + data.missing.carbs;
    document.getElementById('missingFat').textContent = "Fat: " + data.missing.fat;

    const container = document.getElementById('suggestedMealGroups');
    container.innerHTML = "";

    const nutrientLabels = {
      calories: "ğŸš Calories",
      protein: "ğŸ’ª Protein",
      carbs: "ğŸ Carbs",
      fat: "ğŸ¥‘ Fat"
    };

    Object.keys(data.suggested_meals).forEach(nutrient => {
      const group = document.createElement('div');

      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = `áº¨n/Hiá»‡n gá»£i Ã½ ${nutrientLabels[nutrient]}`;
      toggleBtn.className = "mb-2 text-sm font-semibold bg-yellow-200 px-3 py-1 rounded shadow hover:bg-yellow-300";
      
      const list = document.createElement('div');
      list.className = "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4";
      list.id = `group-${nutrient}`;

      toggleBtn.onclick = () => {
        list.classList.toggle("hidden");
      };

      const title = document.createElement('div');
      title.className = "font-semibold text-yellow-700 mt-2 mb-1";
      title.textContent = `Gá»£i Ã½ theo ${nutrientLabels[nutrient]} cÃ²n thiáº¿u:`;

      const meals = data.suggested_meals[nutrient];
      if (meals.length === 0) {
        const msg = document.createElement("div");
        msg.className = "text-gray-500 italic col-span-3";
        msg.textContent = "KhÃ´ng cÃ³ mÃ³n phÃ¹ há»£p.";
        list.appendChild(msg);
      } else {
        meals.forEach(meal => {
          const card = document.createElement("div");
          card.className = "bg-yellow-50 p-3 rounded-lg shadow text-center";

          if (meal.image_url) {
            const img = document.createElement("img");
            img.src = meal.image_url + "?t=" + new Date().getTime();
            img.alt = meal.name;
            img.className = "w-full h-24 object-cover rounded mb-2";
            card.appendChild(img);
          }

          const name = document.createElement("div");
          name.className = "font-bold text-blue-700 mb-1";
          name.textContent = meal.name;
          card.appendChild(name);

          const info = document.createElement("div");
          info.className = "text-sm text-gray-600";
          info.innerHTML = `ğŸ”¥ ${meal.calories} cal<br>ğŸ’ª ${meal.protein}g â€¢ ğŸ ${meal.carbs}g â€¢ ğŸ¥‘ ${meal.fat}g`;
          card.appendChild(info);

          list.appendChild(card);
        });
      }

      group.appendChild(toggleBtn);
      group.appendChild(title);
      group.appendChild(list);
      container.appendChild(group);
    });
  });

  return false;
}
</script>
<!-- Modal Quáº£n lÃ½ ngÆ°á»i dÃ¹ng (chá»‰ admin) Ä‘áº·t trÆ°á»›c </body> -->
{% if user.role == 'admin' %}
<div id="userModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-6xl mx-4 max-h-[95vh] overflow-hidden border-2 border-[#fbc3bc]">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ‘¥
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Quáº£n lÃ½ ngÆ°á»i dÃ¹ng</h2>
          <p class="text-white/80 text-sm">Quáº£n lÃ½ tÃ i khoáº£n vÃ  phÃ¢n quyá»n</p>
        </div>
      </div>
      <button onclick="closeUserModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Content Area -->
    <div class="overflow-y-auto max-h-[calc(95vh-100px)] p-6 bg-gradient-to-b from-pink-50/50 to-white">
      <!-- Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-[#fbc3bc] text-center hover:shadow-xl transition-all duration-300 hover:scale-105">
          <div class="text-2xl font-bold text-[#fbc3bc] mb-1">{{ users|length }}</div>
          <div class="text-sm text-gray-600 font-medium flex items-center justify-center gap-1">
            <span class="text-lg">ğŸ‘¥</span>
            Tá»•ng ngÆ°á»i dÃ¹ng
          </div>
        </div>
        
        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-green-300 text-center hover:shadow-xl transition-all duration-300 hover:scale-105">
          <div class="text-2xl font-bold text-green-600 mb-1">{{ users|selectattr('role', 'eq', 'admin')|list|length }}</div>
          <div class="text-sm text-gray-600 font-medium flex items-center justify-center gap-1">
            <span class="text-lg">ğŸ‘‘</span>
            Admin
          </div>
        </div>
        
        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-blue-300 text-center hover:shadow-xl transition-all duration-300 hover:scale-105">
          <div class="text-2xl font-bold text-blue-600 mb-1">{{ users|selectattr('role', 'eq', 'user')|list|length }}</div>
          <div class="text-sm text-gray-600 font-medium flex items-center justify-center gap-1">
            <span class="text-lg">ğŸ‘¤</span>
            User
          </div>
        </div>
        
        <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-red-300 text-center hover:shadow-xl transition-all duration-300 hover:scale-105">
          <div class="text-2xl font-bold text-red-600 mb-1">{{ users|selectattr('is_banned', 'eq', true)|list|length }}</div>
          <div class="text-sm text-gray-600 font-medium flex items-center justify-center gap-1">
            <span class="text-lg">ğŸš«</span>
            Bá»‹ khÃ³a
          </div>
        </div>
      </div>

      <!-- Users Table Container -->
      <div class="bg-white rounded-3xl shadow-xl overflow-hidden border-2 border-[#fbc3bc]">
        <!-- Table Header (Mobile Hidden) -->
        <div class="hidden md:block bg-[#fbc3bc] text-white">
          <div class="grid grid-cols-12 gap-4 p-4 font-semibold text-center">
            <div class="col-span-1">Avatar</div>
            <div class="col-span-2">TÃªn</div>
            <div class="col-span-3">Email</div>
            <div class="col-span-1">Quyá»n</div>
            <div class="col-span-2">Tráº¡ng thÃ¡i</div>
            <div class="col-span-3">HÃ nh Ä‘á»™ng</div>
          </div>
        </div>

        <!-- Users List -->
        <div class="divide-y divide-pink-100">
          {% for u in users %}
          <!-- Desktop View -->
          <div class="hidden md:grid grid-cols-12 gap-4 p-4 items-center hover:bg-pink-50 transition-all duration-200 group">
            <!-- Avatar -->
            <div class="col-span-1 flex justify-center">
              <img src="{{ u.avatar_url or '/static/default-avatar.png' }}" alt="Avatar" class="w-12 h-12 rounded-full border-2 border-[#fbc3bc] shadow-lg group-hover:scale-110 transition-transform duration-200" />
            </div>
            
            <!-- Name -->
            <div class="col-span-2">
              <div class="font-bold text-gray-800 truncate">{{ u.fullname }}</div>
            </div>
            
            <!-- Email -->
            <div class="col-span-3">
              <div class="text-gray-600 truncate">{{ u.email }}</div>
            </div>
            
            <!-- Role -->
            <div class="col-span-1 flex justify-center">
              {% if u.role == 'admin' %}
              <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-xs border border-green-300 shadow-sm">
                ğŸ‘‘ Admin
              </span>
              {% else %}
              <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold text-xs border border-blue-300 shadow-sm">
                ğŸ‘¤ User
              </span>
              {% endif %}
            </div>
            
            <!-- Status -->
            <div class="col-span-2 flex justify-center">
              {% if u.is_banned %}
              <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full font-bold text-xs border border-red-300 shadow-sm flex items-center gap-1">
                <span>ğŸš«</span> Bá»‹ khÃ³a
              </span>
              {% else %}
              <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-xs border border-green-300 shadow-sm flex items-center gap-1">
                <span>âœ…</span> Hoáº¡t Ä‘á»™ng
              </span>
              {% endif %}
            </div>
            
            <!-- Actions -->
            <div class="col-span-3 flex justify-center gap-2">
              {% if u.is_banned %}
              <button onclick="toggleBan('{{ u._id }}', false)" 
                      class="bg-[#fbc3bc] hover:bg-[#f7b2a8] text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110 border border-white" 
                      title="Má»Ÿ khÃ³a">
                ğŸ”“
              </button>
              {% else %}
              <button onclick="toggleBan('{{ u._id }}', true)" 
                      class="bg-orange-400 hover:bg-orange-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110 border border-white" 
                      title="KhÃ³a tÃ i khoáº£n">
                ğŸ”’
              </button>
              {% endif %}
              
              {% if u._id != user._id %}
              <button onclick="toggleRole('{{ u._id }}', '{{ u.role }}')" 
                      class="bg-blue-400 hover:bg-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110 border border-white" 
                      title="Äá»•i quyá»n">
                ğŸ”„
              </button>
              <button onclick="confirmDeleteUser('{{ u._id }}')" 
                      class="bg-red-400 hover:bg-red-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-110 border border-white" 
                      title="XÃ³a ngÆ°á»i dÃ¹ng">
                ğŸ—‘ï¸
              </button>
              {% endif %}
            </div>
          </div>

          <!-- Mobile View -->
          <div class="md:hidden p-4 hover:bg-pink-50 transition-all duration-200">
            <div class="bg-white rounded-2xl p-4 shadow-lg border-2 border-[#fbc3bc] hover:shadow-xl transition-all duration-300">
              <!-- User Info -->
              <div class="flex items-center gap-4 mb-4">
                <img src="{{ u.avatar_url or '/static/default-avatar.png' }}" alt="Avatar" class="w-16 h-16 rounded-full border-2 border-[#fbc3bc] shadow-lg" />
                <div class="flex-1 min-w-0">
                  <h3 class="font-bold text-gray-800 truncate text-lg">{{ u.fullname }}</h3>
                  <p class="text-gray-600 truncate text-sm">{{ u.email }}</p>
                </div>
              </div>
              
              <!-- Status & Role Row -->
              <div class="flex flex-wrap gap-2 mb-4">
                {% if u.role == 'admin' %}
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-xs border border-green-300 shadow-sm">
                  ğŸ‘‘ Admin
                </span>
                {% else %}
                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold text-xs border border-blue-300 shadow-sm">
                  ğŸ‘¤ User
                </span>
                {% endif %}
                
                {% if u.is_banned %}
                <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full font-bold text-xs border border-red-300 shadow-sm">
                  ğŸš« Bá»‹ khÃ³a
                </span>
                {% else %}
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold text-xs border border-green-300 shadow-sm">
                  âœ… Hoáº¡t Ä‘á»™ng
                </span>
                {% endif %}
              </div>
              
              <!-- Action Buttons -->
              <div class="flex flex-wrap gap-2">
                {% if u.is_banned %}
                <button onclick="toggleBan('{{ u._id }}', false)" 
                        class="flex-1 bg-[#fbc3bc] hover:bg-[#f7b2a8] text-white px-4 py-2 rounded-xl font-bold transition-all duration-200 flex items-center justify-center gap-2 border border-white shadow-lg">
                  <span>ğŸ”“</span> Má»Ÿ khÃ³a
                </button>
                {% else %}
                <button onclick="toggleBan('{{ u._id }}', true)" 
                        class="flex-1 bg-orange-400 hover:bg-orange-500 text-white px-4 py-2 rounded-xl font-bold transition-all duration-200 flex items-center justify-center gap-2 border border-white shadow-lg">
                  <span>ğŸ”’</span> KhÃ³a
                </button>
                {% endif %}
                
                {% if u._id != user._id %}
                <button onclick="toggleRole('{{ u._id }}', '{{ u.role }}')" 
                        class="flex-1 bg-blue-400 hover:bg-blue-500 text-white px-4 py-2 rounded-xl font-bold transition-all duration-200 flex items-center justify-center gap-2 border border-white shadow-lg">
                  <span>ğŸ”„</span> Äá»•i quyá»n
                </button>
                <button onclick="confirmDeleteUser('{{ u._id }}')" 
                        class="bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded-xl font-bold transition-all duration-200 flex items-center justify-center gap-2 border border-white shadow-lg">
                  <span>ğŸ—‘ï¸</span> XÃ³a
                </button>
                {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Empty State -->
        {% if users|length == 0 %}
        <div class="text-center py-16 bg-pink-50">
          <div class="text-8xl mb-4 text-gray-300">ğŸ‘¥</div>
          <h3 class="text-2xl font-bold mb-3 text-gray-500">KhÃ´ng cÃ³ ngÆ°á»i dÃ¹ng nÃ o</h3>
          <p class="text-gray-400">Danh sÃ¡ch ngÆ°á»i dÃ¹ng Ä‘ang trá»‘ng.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
/* Enhanced User Management Modal Styles */
#userModal {
  backdrop-filter: blur(8px);
}

/* Stats cards animation */
#userModal .grid > div {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#userModal .grid > div:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 12px 25px rgba(251, 195, 188, 0.3);
}

/* Table row hover effects */
#userModal .group:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 12px rgba(251, 195, 188, 0.2);
}

/* Button hover enhancements */
#userModal button {
  position: relative;
  overflow: hidden;
}

#userModal button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.3s ease;
}

#userModal button:hover::before {
  width: 120%;
  height: 120%;
}

/* Badge enhancements */
#userModal span[class*="rounded-full"] {
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

#userModal span[class*="rounded-full"]:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

/* Avatar hover effects */
#userModal img {
  transition: all 0.3s ease;
}

#userModal .group:hover img {
  box-shadow: 0 8px 25px rgba(251, 195, 188, 0.4);
}

/* Mobile card hover effects */
@media (max-width: 767px) {
  #userModal .md\:hidden > div {
    transition: all 0.3s ease;
  }
  
  #userModal .md\:hidden:hover > div {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(251, 195, 188, 0.3);
  }
}

/* Enhanced responsive styles */
@media (max-width: 640px) {
  #userModal .max-w-6xl {
    max-width: calc(100vw - 1rem);
    margin: 0 0.5rem;
  }
  
  #userModal .px-6 {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  #userModal .p-6 {
    padding: 1rem;
  }
  
  #userModal .grid-cols-4 {
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
  }
  
  #userModal .text-2xl {
    font-size: 1.25rem;
  }
  
  #userModal .text-xl {
    font-size: 1.125rem;
  }
  
  #userModal .w-16 {
    width: 3.5rem;
    height: 3.5rem;
  }
  
  #userModal .text-lg {
    font-size: 1rem;
  }
  
  #userModal .rounded-3xl {
    border-radius: 1.5rem;
  }
  
  #userModal .rounded-2xl {
    border-radius: 1rem;
  }
  
  #userModal .gap-4 {
    gap: 0.75rem;
  }
  
  #userModal .p-4 {
    padding: 0.75rem;
  }
  
  #userModal button {
    font-size: 0.875rem;
    padding: 0.5rem 0.75rem;
  }
}

@media (max-width: 480px) {
  #userModal .max-w-6xl {
    max-width: calc(100vw - 0.5rem);
    margin: 0 0.25rem;
  }
  
  #userModal .grid-cols-4 {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
  
  #userModal .p-4 {
    padding: 0.5rem;
  }
  
  #userModal .gap-4 {
    gap: 0.5rem;
  }
  
  #userModal .w-16 {
    width: 3rem;
    height: 3rem;
  }
  
  #userModal .text-lg {
    font-size: 0.95rem;
  }
  
  #userModal .text-sm {
    font-size: 0.8rem;
  }
  
  #userModal .text-xs {
    font-size: 0.7rem;
  }
  
  #userModal button {
    font-size: 0.8rem;
    padding: 0.4rem 0.6rem;
  }
  
  #userModal .px-3 {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
  
  #userModal .py-1 {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
  }
}

/* Tablet optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  #userModal .max-w-6xl {
    max-width: calc(100vw - 2rem);
  }
  
  #userModal .grid-cols-12 {
    grid-template-columns: repeat(12, 1fr);
    gap: 0.75rem;
  }
  
  #userModal .col-span-3 {
    grid-column: span 2;
  }
}

/* Loading states */
#userModal .loading {
  opacity: 0.7;
  pointer-events: none;
}

#userModal .loading button {
  position: relative;
}

#userModal .loading button:after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 16px;
  height: 16px;
  margin: -8px 0 0 -8px;
  border: 2px solid transparent;
  border-top: 2px solid #ffffff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  #userModal .border-2 {
    border-width: 3px;
  }
  
  #userModal button {
    border-width: 2px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #userModal,
  #userModal * {
    animation: none !important;
    transition: none !important;
  }
}

/* Dark mode preparation */
@media (prefers-color-scheme: dark) {
  #userModal .bg-white {
    background: #1f2937;
    color: #f9fafb;
  }
  
  #userModal .text-gray-800 {
    color: #f9fafb;
  }
  
  #userModal .text-gray-600 {
    color: #d1d5db;
  }
}

/* Enhanced scrollbar */
#userModal .overflow-y-auto {
  scrollbar-width: thin;
  scrollbar-color: #fbc3bc #f3f4f6;
}

#userModal .overflow-y-auto::-webkit-scrollbar {
  width: 8px;
}

#userModal .overflow-y-auto::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 4px;
}

#userModal .overflow-y-auto::-webkit-scrollbar-thumb {
  background: #fbc3bc;
  border-radius: 4px;
  border: 1px solid #f3f4f6;
}

#userModal .overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: #f7b2a8;
}

/* Enhanced empty state */
#userModal .text-center {
  animation: fadeIn 1s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Performance optimizations */
#userModal .grid > div,
#userModal button,
#userModal img {
  will-change: transform;
}

/* Focus states for accessibility */
#userModal button:focus {
  outline: 2px solid #fbc3bc;
  outline-offset: 2px;
}

/* Print styles */
@media print {
  #userModal {
    display: none !important;
  }
}
</style>
{% endif %}
<script>
function openUserModal() {
  document.getElementById('userModal').classList.remove('hidden');
}
function closeUserModal() {
  document.getElementById('userModal').classList.add('hidden');
}
function toggleBan(userId, ban) {
  fetch('/ban-user', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id: userId, ban: ban}),
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      showNotice(data.message || "CÃ³ lá»—i xáº£y ra!");
    }
  });
}
function toggleRole(userId, currentRole) {
  const newRole = currentRole === 'admin' ? 'user' : 'admin';
  if (!confirm(`Báº¡n cÃ³ cháº¯c muá»‘n Ä‘á»•i quyá»n thÃ nh "${newRole}"?`)) return;
  fetch('/change-role', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id: userId, role: newRole}),
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      showNotice(data.message || "CÃ³ lá»—i xáº£y ra!");
    }
  });
}
</script>
<!-- Modal thÃ´ng bÃ¡o Ä‘Äƒng xuáº¥t -->
<div id="logoutNoticeModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] hidden">
  <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center animate-fade-in">
    <div class="text-red-500 text-5xl mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto w-14 h-14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M12 4a8 8 0 100 16 8 8 0 000-16z" />
      </svg>
    </div>
    <div id="logoutNoticeMsg" class="text-xl font-semibold text-gray-800 mb-6"></div>
    <a href="/login" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-full shadow-lg transition duration-300 ease-in-out">
      ÄÄƒng nháº­p láº¡i
    </a>
  </div>
</div>

<style>
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.animate-fade-in {
  animation: fade-in 0.4s ease-out;
}

  @media (max-width: 400px) {
    .text-3xl { font-size: 1.75rem; }
    .sm\:text-5xl { font-size: 2rem !important; }
    .rounded-xl, .rounded-2xl { border-radius: 1rem !important; }
    .sm\:text-lg { font-size: 1rem !important; }
    .sm\:px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
  }

</style>

<script>
function showLogoutNotice(msg) {
  document.getElementById('logoutNoticeMsg').textContent = msg;
  document.getElementById('logoutNoticeModal').classList.remove('hidden');
  setTimeout(() => {
    window.location.href = '/login';
  }, 2500);
}

function checkSession() {
  fetch('/check-session', {credentials: 'include'})
    .then(res => res.json())
    .then(data => {
      if (!data.valid) {
        let msg = '';
        if (data.reason === 'ban') msg = 'TÃ i khoáº£n cá»§a báº¡n Ä‘Ã£ bá»‹ khÃ³a!';
        else if (data.reason === 'other_login') msg = 'TÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng nháº­p á»Ÿ nÆ¡i khÃ¡c!';
        else msg = 'PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n!';
        showLogoutNotice(msg);
      }
    });
}
setInterval(checkSession, 10000);

function toggleRole(userId, currentRole) {
  const newRole = currentRole === 'admin' ? 'user' : 'admin';
  // XoÃ¡ dÃ²ng confirm Ä‘á»ƒ khÃ´ng hiá»‡n popup xÃ¡c nháº­n
  fetch('/change-role', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id: userId, role: newRole}),
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      showNotice("Äá»•i quyá»n thÃ nh cÃ´ng!", true);
      setTimeout(() => location.reload(), 1200);
    } else {
      showNotice(data.message || "CÃ³ lá»—i xáº£y ra!", false);
    }
  });
}
</script>
<div id="customNotice" class="fixed top-8 left-1/2 -translate-x-1/2 z-[9999] hidden px-6 py-3 rounded-xl shadow-2xl font-semibold text-white text-lg transition-all duration-300"></div>
<script>
function showNotice(msg, success=true) {
  const el = document.getElementById('customNotice');
  el.textContent = msg;
  el.className = "fixed top-8 left-1/2 -translate-x-1/2 z-[9999] px-6 py-3 rounded-xl shadow-2xl font-semibold text-lg transition-all duration-300 " + (success ? "bg-green-600" : "bg-red-600");
  el.style.display = '';
  setTimeout(() => { el.style.display = 'none'; }, 2200);
}
</script>
<!-- Modal xÃ¡c nháº­n xÃ³a ngÆ°á»i dÃ¹ng -->
<div id="deleteUserModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] hidden">
  <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center animate-fade-in">
    <div class="text-red-500 text-5xl mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto w-14 h-14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M12 4a8 8 0 100 16 8 8 0 000-16z" />
      </svg>
    </div>
    <div class="text-xl font-semibold text-gray-800 mb-6">Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a ngÆ°á»i dÃ¹ng nÃ y?</div>
    <div class="flex justify-center gap-4">
      <button onclick="closeDeleteUserModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded font-bold">Há»§y</button>
      <button id="confirmDeleteUserBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-bold">XÃ³a</button>
    </div>
  </div>
</div>

<script>
let userIdToDelete = null;
function confirmDeleteUser(userId) {
  userIdToDelete = userId;
  document.getElementById('deleteUserModal').classList.remove('hidden');
}
function closeDeleteUserModal() {
  userIdToDelete = null;
  document.getElementById('deleteUserModal').classList.add('hidden');
}
document.getElementById('confirmDeleteUserBtn').onclick = function() {
  if (!userIdToDelete) return;
  fetch('/delete-user', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id: userIdToDelete}),
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      showNotice("XÃ³a ngÆ°á»i dÃ¹ng thÃ nh cÃ´ng!", true);
      setTimeout(() => location.reload(), 1200);
    } else {
      showNotice(data.message || "CÃ³ lá»—i xáº£y ra!", false);
    }
    closeDeleteUserModal();
  });
};
</script>
<style>
.scrollbar-thin::-webkit-scrollbar {
  width: 7px;
  background: #f3f4f6;
}
.scrollbar-thin::-webkit-scrollbar-thumb {
  background: #60a5fa;
  border-radius: 8px;
  min-height: 40px;
  border: 2px solid #f3f4f6;
  transition: background 0.2s;
}
.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background: #2563eb;
}
.scrollbar-thin::-webkit-scrollbar-corner {
  background: #f3f4f6;
}
.scrollbar-thumb-rounded::-webkit-scrollbar-thumb {
  border-radius: 8px;
}
#activityLogContent table,
#loginLogContent table {
  width: 100%;
  border-collapse: collapse;
  min-width: 700px;
}

#activityLogContent th,
#activityLogContent td,
#loginLogContent th,
#loginLogContent td {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid #e5e7eb;
  text-align: left;
  vertical-align: middle;
  white-space: nowrap;
}
#activityLogContent th,
#loginLogContent th {
  background: linear-gradient(to right, #2563eb, #38bdf8);
  color: #fff;
  font-weight: 600;
  text-align: center;
}
#activityLogContent tr:nth-child(even),
#loginLogContent tr:nth-child(even) {
  background-color: #f1f5f9;
}
#activityLogContent tr:hover,
#loginLogContent tr:hover {
  background-color: #e0e7ef;
}
@media (max-width: 900px) {
  #activityLogContent table,
  #loginLogContent table {
    min-width: 600px;
    font-size: 0.95rem;
  }
}
@media (max-width: 700px) {
  #activityLogContent table,
  #loginLogContent table {
    min-width: 400px;
    font-size: 0.9rem;
  }
  #activityLogModal .p-8,
  #loginLogModal .p-8 {
    padding: 1rem !important;
  }
}
  #sidebar.open {
    transform: translateX(0);
  }
  #sidebarOverlay {
    display: block;
  }
  main {
    flex-direction: column;
  }
  section {
    margin-top: 0;
  }
@media (max-width: 640px) {
  .modal, .max-w-md, .max-w-2xl, .max-w-3xl {
    max-width: 98vw !important;
    padding: 0.5rem !important;
  }
  .p-6, .p-8 {  
    padding: 1rem !important;
  }
  .rounded-2xl, .rounded-xl {
    border-radius: 1rem !important;
  }
}
#sidebarOverlay.hidden {
  pointer-events: none;
  opacity: 0;
}

  @media (max-width: 400px) {
    .text-3xl { font-size: 1.75rem; }
    .sm\:text-5xl { font-size: 2rem !important; }
    .rounded-xl, .rounded-2xl { border-radius: 1rem !important; }
    .sm\:text-lg { font-size: 1rem !important; }
    .sm\:px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
  }
@media (max-width: 767px) {
  #sidebarCollapseBtn { display: none !important; }
  header > div > div:first-child {
    margin-bottom: 8px;
  }
  header > div {
    gap: 0.5rem;
  }
}
</style>
{% if user.role == 'admin' %}
<style>
@media (max-width: 767px) {
  #sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 50;
    width: 60vw;        
    max-width: 180px;      
    transform: translateX(-100%);
    transition: transform 0.3s;
    background: #fbc3bc;
  }
}

  @media (max-width: 400px) {
    .text-3xl { font-size: 1.75rem; }
    .sm\:text-5xl { font-size: 2rem !important; }
    .rounded-xl, .rounded-2xl { border-radius: 1rem !important; }
    .sm\:text-lg { font-size: 1rem !important; }
    .sm\:px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
  }

</style>
{% else %}
<style>
@media (max-width: 767px) {
  #sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 50;
    width: 67vw;          
    max-width: 180px;      
    transform: translateX(-100%);
    transition: transform 0.3s;
    background: #fbc3bc;
  }
}

  @media (max-width: 400px) {
    .text-3xl { font-size: 1.75rem; }
    .sm\:text-5xl { font-size: 2rem !important; }
    .rounded-xl, .rounded-2xl { border-radius: 1rem !important; }
    .sm\:text-lg { font-size: 1rem !important; }
    .sm\:px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
  }

</style>
{% endif %}
<script>
// Enhanced Sidebar Functions
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  
  if (window.innerWidth < 768) {
    // Mobile behavior
    const isOpen = sidebar.classList.contains('open');
    if (isOpen) {
      closeSidebar();
    } else {
      openSidebar();
    }
  }
}

function openSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  
  sidebar.classList.add('open');
  overlay.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  
  sidebar.classList.remove('open');
  overlay.classList.add('hidden');
  document.body.style.overflow = '';
}

function closeSidebarOnMobile() {
  if (window.innerWidth < 768) {
    closeSidebar();
  }
}

function toggleSidebarCollapse() {
  if (window.innerWidth >= 768) {
    const sidebar = document.getElementById('sidebar');
    const icon = document.getElementById('sidebarToggleIcon');
    
    sidebar.classList.toggle('collapsed');
    
    // Icon animation with smooth transition
    if (sidebar.classList.contains('collapsed')) {
      icon.style.transform = 'rotate(180deg)';
    } else {
      icon.style.transform = 'rotate(0deg)';
    }
  }
}

// Enhanced event handlers
document.addEventListener('DOMContentLoaded', function() {
  // Auto-close sidebar on mobile when clicking nav items
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      closeSidebarOnMobile();
    });
  });
  
  // Handle window resize
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) {
      // Desktop: remove mobile classes and restore scroll
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.add('hidden');
      document.body.style.overflow = '';
    } else {
      // Mobile: remove collapsed state
      document.getElementById('sidebar').classList.remove('collapsed');
    }
  });
  
  // Enhanced keyboard navigation
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeSidebar();
    }
  });
  
  // Smooth scroll to top when switching views
  function smoothScrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }
  
  // Add active state management
  function setActiveNavButton(viewName) {
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    
    const activeBtn = document.getElementById('btn-' + viewName);
    if (activeBtn) {
      activeBtn.classList.add('active');
    }
  }
  
  // Enhanced view switching with active states
  window.switchView = function(view) {
    // Hide all views
    document.getElementById("welcomeView").classList.add("hidden");
    document.getElementById("mealsView").classList.add("hidden");
    document.getElementById("logView").classList.add("hidden");
    
    // Show target view
    document.getElementById(view + "View").classList.remove("hidden");
    
    // Set active button
    setActiveNavButton(view);
    
    // Close sidebar on mobile
    closeSidebarOnMobile();
    
    // Smooth scroll to top
    smoothScrollToTop();
  };
  
  // Enhanced home function
  window.goHome = function() {
    // Hide all views
    document.getElementById("mealsView").classList.add("hidden");
    document.getElementById("logView").classList.add("hidden");
    document.getElementById("welcomeView").classList.remove("hidden");
    
    // Remove active states
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    
    // Close sidebar on mobile
    closeSidebarOnMobile();
    
    // Smooth scroll to top
    smoothScrollToTop();
  };
});

// Touch gesture support for mobile sidebar
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', function(e) {
  touchStartX = e.changedTouches[0].screenX;
});

document.addEventListener('touchend', function(e) {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipeGesture();
});

function handleSwipeGesture() {
  if (window.innerWidth < 768) {
    const swipeThreshold = 50;
    const sidebar = document.getElementById('sidebar');
    
    // Swipe right to open sidebar (from left edge)
    if (touchEndX - touchStartX > swipeThreshold && touchStartX < 50) {
      openSidebar();
    }
    
    // Swipe left to close sidebar
    if (touchStartX - touchEndX > swipeThreshold && sidebar.classList.contains('open')) {
      closeSidebar();
    }
  }
}
</script>
<!-- Modal Nháº­t kÃ½ hoáº¡t Ä‘á»™ng (Admin) -->
<div id="activityLogModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-6xl mx-4 max-h-[95vh] overflow-hidden border-2 border-[#fbc3bc]">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ“œ
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Nháº­t kÃ½ hoáº¡t Ä‘á»™ng</h2>
          <p class="text-white/80 text-sm">Theo dÃµi hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng</p>
        </div>
      </div>
      <button type="button" onclick="closeActivityLogModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Content -->
    <div class="overflow-y-auto max-h-[calc(95vh-100px)] bg-gradient-to-b from-pink-50/50 to-white">
      <div class="p-6">
        <div id="activityLogContent" class="min-h-[200px] flex items-center justify-center">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#fbc3bc] mb-4"></div>
            <p class="text-gray-600">Äang táº£i dá»¯ liá»‡u...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Nháº­t kÃ½ Ä‘Äƒng nháº­p (Admin) -->
<div id="loginLogModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-7xl mx-4 max-h-[95vh] overflow-hidden border-2 border-[#fbc3bc]">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ”‘
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Nháº­t kÃ½ Ä‘Äƒng nháº­p</h2>
          <p class="text-white/80 text-sm">Theo dÃµi Ä‘Äƒng nháº­p cá»§a ngÆ°á»i dÃ¹ng</p>
        </div>
      </div>
      <button type="button" onclick="closeLoginLogModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Content -->
    <div class="overflow-y-auto max-h-[calc(95vh-100px)] bg-gradient-to-b from-pink-50/50 to-white">
      <div class="p-6">
        <div id="loginLogContent" class="min-h-[200px] flex items-center justify-center">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#fbc3bc] mb-4"></div>
            <p class="text-gray-600">Äang táº£i dá»¯ liá»‡u...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Enhanced Modal Styles vá»›i mÃ u pastel */
#activityLogModal, #loginLogModal {
  backdrop-filter: blur(8px);
}

/* Custom table styles vá»›i mÃ u pastel */
.activity-log-table, .login-log-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
  background: #fff;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(251, 195, 188, 0.2);
  margin: 24px 0;
  border: 2px solid #fbc3bc;
}

.activity-log-table th, .activity-log-table td,
.login-log-table th, .login-log-table td {
  padding: 16px 20px;
  border-bottom: 1px solid rgba(251, 195, 188, 0.2);
  text-align: left;
  transition: all 0.3s ease;
}

.activity-log-table th, .login-log-table th {
  background: #fbc3bc;
  color: #fff;
  font-weight: 700;
  letter-spacing: 0.5px;
  border-bottom: 2px solid rgba(255, 255, 255, 0.3);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.activity-log-table tr:last-child td,
.login-log-table tr:last-child td {
  border-bottom: none;
}

.activity-log-table tbody tr:hover td,
.login-log-table tbody tr:hover td {
  background: rgba(251, 195, 188, 0.1);
  transform: translateY(-1px);
}

.activity-log-table td, .login-log-table td {
  vertical-align: middle;
}

/* Specific cell styles */
.action-cell {
  font-weight: 500;
  color: #8b5a3c;
  background: rgba(251, 195, 188, 0.05);
  border-radius: 8px;
  margin: 2px;
  padding: 8px 12px;
}

.time-cell {
  color: #666;
  font-family: 'Courier New', monospace;
  background: #f8f9fa;
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 13px;
}

.user-cell {
  font-weight: 600;
  color: #d63384;
  background: rgba(251, 195, 188, 0.1);
  border-radius: 8px;
  padding: 6px 12px;
}

.ip-cell {
  font-family: 'Courier New', monospace;
  background: rgba(251, 195, 188, 0.15);
  border-radius: 8px;
  padding: 6px 10px;
  display: inline-block;
  font-size: 13px;
  color: #8b5a3c;
  border: 1px solid rgba(251, 195, 188, 0.3);
}

.location-cell {
  color: #6c757d;
  font-style: italic;
}

.isp-cell {
  color: #6f42c1;
  font-weight: 500;
  background: rgba(111, 66, 193, 0.1);
  border-radius: 6px;
  padding: 4px 8px;
}

.map-link {
  background: #fbc3bc;
  color: white !important;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 12px;
  text-decoration: none !important;
  display: inline-block;
  transition: all 0.3s ease;
  border: 1px solid transparent;
  font-weight: 500;
}

.map-link:hover {
  background: #f7b2a8;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(251, 195, 188, 0.4);
  border-color: rgba(255, 255, 255, 0.3);
}

.log-header {
  text-align: center;
  margin: 20px 0;
  color: #fbc3bc;
  font-size: 24px;
  font-weight: bold;
  text-shadow: 0 2px 4px rgba(251, 195, 188, 0.2);
  padding: 15px;
  background: rgba(251, 195, 188, 0.1);
  border-radius: 15px;
  border: 2px solid rgba(251, 195, 188, 0.3);
}

/* Enhanced responsive design */
@media (max-width: 1024px) {
  #activityLogModal .max-w-6xl,
  #loginLogModal .max-w-7xl {
    max-width: calc(100vw - 2rem);
    margin: 0 1rem;
  }
  
  .activity-log-table th, .activity-log-table td,
  .login-log-table th, .login-log-table td {
    padding: 12px 16px;
    font-size: 14px;
  }
}

@media (max-width: 768px) {
  #activityLogModal .max-w-6xl,
  #loginLogModal .max-w-7xl {
    max-width: calc(100vw - 1rem);
    margin: 0 0.5rem;
    max-height: 90vh;
  }
  
  #activityLogModal .px-6,
  #loginLogModal .px-6 {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  .activity-log-table, .activity-log-table thead, .activity-log-table tbody, 
  .activity-log-table th, .activity-log-table td, .activity-log-table tr,
  .login-log-table, .login-log-table thead, .login-log-table tbody, 
  .login-log-table th, .login-log-table td, .login-log-table tr {
    display: block;
  }
  
  .activity-log-table th, .login-log-table th {
    position: sticky;
    top: 0;
    z-index: 2;
    border-radius: 0;
    padding: 12px;
    text-align: center;
  }
  
  .activity-log-table td, .login-log-table td {
    border: none;
    border-bottom: 1px solid rgba(251, 195, 188, 0.2);
    position: relative;
    padding-left: 45%;
    min-height: 48px;
    padding-top: 12px;
    padding-bottom: 12px;
  }
  
  .activity-log-table td:before, .login-log-table td:before {
    position: absolute;
    left: 12px;
    top: 12px;
    width: 40%;
    white-space: nowrap;
    font-weight: bold;
    color: #fbc3bc;
    font-size: 13px;
  }
  
  /* Activity log mobile labels */
  .activity-log-table td:nth-of-type(1):before { content: "ğŸ• Thá»i gian"; }
  .activity-log-table td:nth-of-type(2):before { content: "ğŸ‘¤ NgÆ°á»i dÃ¹ng"; }
  .activity-log-table td:nth-of-type(3):before { content: "âš¡ HÃ nh Ä‘á»™ng"; }
  
  /* Login log mobile labels */
  .login-log-table td:nth-of-type(1):before { content: "ğŸ• Thá»i gian"; }
  .login-log-table td:nth-of-type(2):before { content: "ğŸ‘¤ NgÆ°á»i dÃ¹ng"; }
  .login-log-table td:nth-of-type(3):before { content: "ğŸŒ IP"; }
  .login-log-table td:nth-of-type(4):before { content: "ğŸ“ Äá»‹a chá»‰"; }
  .login-log-table td:nth-of-type(5):before { content: "ğŸ¢ NhÃ  máº¡ng"; }
  .login-log-table td:nth-of-type(6):before { content: "ğŸ—ºï¸ Báº£n Ä‘á»“"; }
  
  .ip-cell, .map-link {
    font-size: 11px;
    padding: 4px 8px;
  }
  
  .log-header {
    font-size: 20px;
    padding: 12px;
    margin: 15px 0;
  }
}

@media (max-width: 480px) {
  #activityLogModal .rounded-3xl,
  #loginLogModal .rounded-3xl {
    border-radius: 1.5rem;
  }
  
  #activityLogModal .py-5,
  #loginLogModal .py-5 {
    padding-top: 1rem;
    padding-bottom: 1rem;
  }
  
  .activity-log-table, .login-log-table {
    border-radius: 15px;
    margin: 15px 0;
  }
  
  .activity-log-table td, .login-log-table td {
    padding-left: 50%;
    font-size: 13px;
  }
  
  .activity-log-table td:before, .login-log-table td:before {
    width: 45%;
    font-size: 12px;
  }
  
  .log-header {
    font-size: 18px;
    padding: 10px;
  }
}

/* Empty state styling */
.empty-log-state {
  text-align: center;
  padding: 40px 20px;
  color: #6c757d;
  background: rgba(251, 195, 188, 0.05);
  border-radius: 15px;
  border: 2px dashed rgba(251, 195, 188, 0.3);
  margin: 20px 0;
}

.empty-log-state .empty-icon {
  font-size: 4rem;
  margin-bottom: 15px;
  opacity: 0.6;
}

.empty-log-state h3 {
  color: #fbc3bc;
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 10px;
}

.empty-log-state p {
  color: #6c757d;
  font-size: 1rem;
}

/* Loading state */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  min-height: 300px;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(251, 195, 188, 0.2);
  border-top: 4px solid #fbc3bc;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  color: #fbc3bc;
  font-size: 1.1rem;
  font-weight: 500;
}

/* Enhanced scrollbar */
#activityLogContent::-webkit-scrollbar,
#loginLogContent::-webkit-scrollbar {
  width: 8px;
}

#activityLogContent::-webkit-scrollbar-track,
#loginLogContent::-webkit-scrollbar-track {
  background: rgba(251, 195, 188, 0.1);
  border-radius: 4px;
}

#activityLogContent::-webkit-scrollbar-thumb,
#loginLogContent::-webkit-scrollbar-thumb {
  background: #fbc3bc;
  border-radius: 4px;
}

#activityLogContent::-webkit-scrollbar-thumb:hover,
#loginLogContent::-webkit-scrollbar-thumb:hover {
  background: #f7b2a8;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .activity-log-table, .login-log-table {
    border-width: 3px;
  }
  
  .activity-log-table th, .activity-log-table td,
  .login-log-table th, .login-log-table td {
    border-width: 2px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .activity-log-table tbody tr:hover td,
  .login-log-table tbody tr:hover td,
  .map-link:hover {
    transform: none;
    transition: none;
  }
  
  .loading-spinner {
    animation: none;
  }
}

/* Dark mode preparation */
@media (prefers-color-scheme: dark) {
  .activity-log-table, .login-log-table {
    background: #1f2937;
    color: #f9fafb;
  }
  
  .activity-log-table th, .login-log-table th {
    background: #374151;
  }
  
  .activity-log-table tbody tr:hover td,
  .login-log-table tbody tr:hover td {
    background: #374151;
  }
}
</style>

<script>
// Enhanced modal functions with loading states
function openActivityLogModal() {
  document.getElementById('activityLogModal').classList.remove('hidden');
  loadActivityLog();
}

function closeActivityLogModal() {
  document.getElementById('activityLogModal').classList.add('hidden');
}

function openLoginLogModal() {
  document.getElementById('loginLogModal').classList.remove('hidden');
  loadLoginLog();
}

function closeLoginLogModal() {
  document.getElementById('loginLogModal').classList.add('hidden');
}

// Enhanced loading functions with better error handling
async function loadActivityLog() {
  const contentDiv = document.getElementById('activityLogContent');
  
  // Show loading state
  contentDiv.innerHTML = `
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">Äang táº£i nháº­t kÃ½ hoáº¡t Ä‘á»™ng...</div>
    </div>
  `;
  
  try {
    const response = await fetch('/activity-log');
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const html = await response.text();
    
    // Check if empty response
    if (!html.trim() || html.includes('ChÆ°a cÃ³ nháº­t kÃ½')) {
      contentDiv.innerHTML = `
        <div class="empty-log-state">
          <div class="empty-icon">ğŸ“‹</div>
          <h3>ChÆ°a cÃ³ nháº­t kÃ½ hoáº¡t Ä‘á»™ng</h3>
          <p>Há»‡ thá»‘ng chÆ°a ghi nháº­n hoáº¡t Ä‘á»™ng nÃ o.</p>
        </div>
      `;
      return;
    }
    
    contentDiv.innerHTML = html;
    
  } catch (error) {
    console.error('Error loading activity log:', error);
    contentDiv.innerHTML = `
      <div class="empty-log-state">
        <div class="empty-icon">âš ï¸</div>
        <h3>Lá»—i táº£i dá»¯ liá»‡u</h3>
        <p>KhÃ´ng thá»ƒ táº£i nháº­t kÃ½ hoáº¡t Ä‘á»™ng. Vui lÃ²ng thá»­ láº¡i.</p>
        <button onclick="loadActivityLog()" class="mt-4 bg-[#fbc3bc] text-white px-4 py-2 rounded-lg hover:bg-[#f7b2a8] transition-colors">
          ğŸ”„ Thá»­ láº¡i
        </button>
      </div>
    `;
  }
}

async function loadLoginLog() {
  const contentDiv = document.getElementById('loginLogContent');
  
  // Show loading state
  contentDiv.innerHTML = `
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">Äang táº£i nháº­t kÃ½ Ä‘Äƒng nháº­p...</div>
    </div>
  `;
  
  try {
    const response = await fetch('/login-log');
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const html = await response.text();
    
    // Check if empty response
    if (!html.trim() || html.includes('ChÆ°a cÃ³ nháº­t kÃ½')) {
      contentDiv.innerHTML = `
        <div class="empty-log-state">
          <div class="empty-icon">ğŸ”‘</div>
          <h3>ChÆ°a cÃ³ nháº­t kÃ½ Ä‘Äƒng nháº­p</h3>
          <p>Há»‡ thá»‘ng chÆ°a ghi nháº­n Ä‘Äƒng nháº­p nÃ o.</p>
        </div>
      `;
      return;
    }
    
    contentDiv.innerHTML = html;
    
  } catch (error) {
    console.error('Error loading login log:', error);
    contentDiv.innerHTML = `
      <div class="empty-log-state">
        <div class="empty-icon">âš ï¸</div>
        <h3>Lá»—i táº£i dá»¯ liá»‡u</h3>
        <p>KhÃ´ng thá»ƒ táº£i nháº­t kÃ½ Ä‘Äƒng nháº­p. Vui lÃ²ng thá»­ láº¡i.</p>
        <button onclick="loadLoginLog()" class="mt-4 bg-[#fbc3bc] text-white px-4 py-2 rounded-lg hover:bg-[#f7b2a8] transition-colors">
          ğŸ”„ Thá»­ láº¡i
        </button>
      </div>
    `;
  }
}

// Close modals when clicking outside
document.addEventListener('click', function(e) {
  const activityModal = document.getElementById('activityLogModal');
  const loginModal = document.getElementById('loginLogModal');
  
  if (e.target === activityModal) {
    closeActivityLogModal();
  }
  
  if (e.target === loginModal) {
    closeLoginLogModal();
  }
});

// Prevent modal close when clicking inside
document.getElementById('activityLogModal')?.addEventListener('click', function(e) {
  e.stopPropagation();
});

document.getElementById('loginLogModal')?.addEventListener('click', function(e) {
  e.stopPropagation();
});

// Enhanced keyboard support
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    if (!document.getElementById('activityLogModal').classList.contains('hidden')) {
      closeActivityLogModal();
    }
    if (!document.getElementById('loginLogModal').classList.contains('hidden')) {
      closeLoginLogModal();
    }
  }
});
</script>
<!-- Modal Ghi nháº­n hoáº¡t Ä‘á»™ng -->
<div id="activityModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 ease-in-out">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden border-2 border-pink-200">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#fbc3bc] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸƒ
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Hoáº¡t Ä‘á»™ng thá»ƒ cháº¥t</h2>
          <p class="text-white/80 text-sm">Ghi nháº­n váº­n Ä‘á»™ng hÃ´m nay</p>
        </div>
      </div>
      <button type="button" onclick="closeActivityModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Form Content -->
    <form id="activityForm" class="p-6 space-y-5 bg-gradient-to-b from-pink-50/50 to-white">
      <!-- Chá»n hoáº¡t Ä‘á»™ng -->
      <div class="space-y-2">
        <label class="block font-semibold text-gray-700 flex items-center gap-2">
          <span class="w-2 h-2 bg-pink-400 rounded-full"></span>
          Loáº¡i hoáº¡t Ä‘á»™ng 
          <span class="text-red-500 text-lg">*</span>
        </label>
        <div class="relative">
          <select name="activity" class="w-full border-2 border-pink-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-300/30 focus:border-pink-400 transition-all duration-300 font-medium text-gray-700 appearance-none cursor-pointer" required>
            <option value="" class="text-gray-400">-- Chá»n hoáº¡t Ä‘á»™ng --</option>
            <option value="walking" class="py-2">ğŸš¶ Äi bá»™</option>
            <option value="running" class="py-2">ğŸƒ Cháº¡y bá»™</option>
            <option value="cycling" class="py-2">ğŸš´ Äáº¡p xe</option>
            <option value="swimming" class="py-2">ğŸŠ BÆ¡i lá»™i</option>
            <option value="yoga" class="py-2">ğŸ§˜ Yoga</option>
            <option value="weightlifting" class="py-2">ğŸ‹ï¸ Táº­p táº¡</option>
            <option value="jumping_rope" class="py-2">ğŸ¤¾ Nháº£y dÃ¢y</option>
          </select>
          <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
            <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Thá»i gian -->
      <div class="space-y-2">
        <label class="block font-semibold text-gray-700 flex items-center gap-2">
          <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
          Thá»i gian (phÃºt) 
          <span class="text-red-500 text-lg">*</span>
        </label>
        <div class="relative">
          <input name="duration" type="number" min="1" placeholder="VD: 30" class="w-full border-2 border-blue-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-300/30 focus:border-blue-400 transition-all duration-300 font-medium text-gray-700 pl-12" required>
          <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400 text-lg">
            â±ï¸
          </div>
        </div>
      </div>

      <!-- ThÃ´ng bÃ¡o lá»—i -->
      <div id="activityError" class="text-red-600 text-sm font-semibold hidden bg-red-50 p-3 rounded-xl border border-red-200"></div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4">
        <button type="button" onclick="closeActivityModal()" class="w-full sm:w-auto order-2 sm:order-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-2xl font-semibold transition-all duration-200 border-2 border-gray-200 hover:border-gray-300">
          Huá»·
        </button>
        <button type="submit" class="w-full sm:w-auto order-1 sm:order-2 bg-[#fbc3bc] hover:bg-[#f7b2a8] text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 border-2 border-[#fbc3bc] hover:border-[#f7b2a8]">
          <span class="text-xl">ğŸ’¾</span> 
          <span>LÆ°u hoáº¡t Ä‘á»™ng</span>
        </button>
      </div>
    </form>

    <!-- Link xem lá»‹ch sá»­ -->
    <div class="px-6 pb-6 pt-0">
      <button onclick="openActivityHistoryModal()" class="w-full bg-pink-50 hover:bg-pink-100 text-pink-600 px-4 py-3 rounded-2xl font-semibold transition-all duration-200 border border-pink-200 hover:border-pink-300 flex items-center justify-center gap-2">
        <span class="text-lg">ğŸ“œ</span> 
        <span>Xem lá»‹ch sá»­ hoáº¡t Ä‘á»™ng</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng -->
<div id="activityHistoryModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl mx-4 max-h-[95vh] overflow-hidden border-2 border-green-200">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#a0e7a0] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ“‹
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng</h2>
          <p class="text-white/80 text-sm">Theo dÃµi táº¥t cáº£ hoáº¡t Ä‘á»™ng thá»ƒ cháº¥t</p>
        </div>
      </div>
      <button type="button" onclick="closeActivityHistoryModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Content -->
    <div class="p-6 bg-gradient-to-b from-green-50/50 to-white">
      <div id="activityHistoryContent" class="bg-white rounded-2xl shadow-lg overflow-hidden border-2 border-green-100">
        <div class="flex items-center justify-center py-16 text-gray-400">
          <div class="text-center">
            <div class="text-6xl mb-4 animate-pulse">ğŸƒ</div>
            <div class="text-lg font-medium">Äang táº£i dá»¯ liá»‡u...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
// Má»Ÿ modal ghi nháº­n hoáº¡t Ä‘á»™ng
function openActivityModal() {
  document.getElementById('activityModal').classList.remove('hidden');
  document.getElementById('activityForm').reset();
  document.getElementById('activityError').textContent = '';
}
// ÄÃ³ng modal ghi nháº­n hoáº¡t Ä‘á»™ng
function closeActivityModal() {
  document.getElementById('activityModal').classList.add('hidden');
}
// Xá»­ lÃ½ submit hoáº¡t Ä‘á»™ng thá»ƒ cháº¥t báº±ng AJAX
document.getElementById('activityForm').onsubmit = function(event) {
  event.preventDefault();
  const form = event.target;
  const data = new FormData(form);
  fetch('/activity', {
    method: 'POST',
    body: data,
    credentials: 'same-origin'
  })
  .then(res => {
    if (res.ok) return res.json();
    return res.json().then(err => { throw err; });
  })
  .then(result => {
    closeActivityModal();
    showNotice("Ghi nháº­n hoáº¡t Ä‘á»™ng thÃ nh cÃ´ng!", true);
  })
  .catch(err => {
    document.getElementById('activityError').textContent = err.message || "CÃ³ lá»—i xáº£y ra!";
  });
};
window.addEventListener('resize', () => {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  if (window.innerWidth >= 767) {
    sidebar.classList.remove('open');
    overlay.classList.add('hidden');
  }
});
// Má»Ÿ modal lá»‹ch sá»­ hoáº¡t Ä‘á»™ng
function openActivityHistoryModal() {
  document.getElementById('activityHistoryModal').classList.remove('hidden');
  document.getElementById('activityHistoryContent').innerHTML = '<div class="text-gray-400 text-center py-8">Äang táº£i...</div>';
fetch('/activity-history')
  .then(res => res.json())
  .then(data => {
    let html = `
      <table class="min-w-full text-sm border rounded-xl overflow-hidden shadow">
        <thead>
          <tr class="bg-blue-100 text-blue-700">
            <th class="px-4 py-2">Há» tÃªn</th>
            <th class="px-4 py-2">Hoáº¡t Ä‘á»™ng</th>
            <th class="px-4 py-2">Thá»i gian</th>
            <th class="px-4 py-2">Calories</th>
          </tr>
        </thead>
        <tbody>
    `;
    if (data.error) {
      html += `<tr><td colspan="4" class="text-center text-red-500 py-4">${data.error}</td></tr>`;
    } else if (data.length === 0) {
      html += '<tr><td colspan="4" class="text-center text-gray-500 py-4">ChÆ°a cÃ³ hoáº¡t Ä‘á»™ng nÃ o</td></tr>';
    } else {
      // ...existing code...
data.forEach(act => {
  let activityName = act.activity;
  if (activityName === 'jumping_rope') activityName = 'Nháº£y dÃ¢y';
  else if (activityName === 'walking') activityName = 'Äi bá»™';
  else if (activityName === 'running') activityName = 'Cháº¡y bá»™';
  else if (activityName === 'cycling') activityName = 'Äáº¡p xe';
  else if (activityName === 'swimming') activityName = 'BÆ¡i lá»™i';
  else if (activityName === 'yoga') activityName = 'Yoga';
  else if (activityName === 'weightlifting') activityName = 'Táº­p táº¡';

  html += `<tr class="hover:bg-blue-50 transition">
    <td class="px-4 py-2">${act.fullname || ''}</td>
    <td class="px-4 py-2 capitalize">${activityName}</td>
    <td class="px-4 py-2">${act.timestamp}</td>
    <td class="px-4 py-2 font-semibold text-blue-600">${act.calories_burned} kcal</td>
  </tr>`;
});
    }
    html += '</tbody></table>';
    document.getElementById('activityHistoryContent').innerHTML = html;
  });
}
// ÄÃ³ng modal lá»‹ch sá»­ hoáº¡t Ä‘á»™ng
function closeActivityHistoryModal() {
  document.getElementById('activityHistoryModal').classList.add('hidden');
}
function toggleSidebarCollapse() {
  const sidebar = document.getElementById('sidebar');
  const icon = document.getElementById('sidebarToggleIcon');
  sidebar.classList.toggle('collapsed');
  icon.innerHTML = sidebar.classList.contains('collapsed')
    ? `<path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />`
    : `<path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />`;
}
</script>
<!-- Modal ThÃ´ng tin cÃ¡ nhÃ¢n -->
<div id="profileModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl mx-4 max-h-[95vh] overflow-hidden border-2 border-purple-200">
    <!-- Header vá»›i mÃ u pastel -->
    <div class="bg-[#c8b2db] px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
          ğŸ‘¤
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">ThÃ´ng tin cÃ¡ nhÃ¢n</h2>
          <p class="text-white/80 text-sm">Quáº£n lÃ½ há»“ sÆ¡ vÃ  sá»©c khá»e</p>
        </div>
      </div>
      <button type="button" onclick="closeProfileModal()" class="text-white/80 hover:text-white text-3xl font-bold transition-colors duration-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20">
        Ã—
      </button>
    </div>

    <!-- Content -->
    <div class="overflow-y-auto max-h-[calc(95vh-100px)]">
      <!-- ThÃ´ng bÃ¡o -->
      <div id="profileNotice" class="hidden mx-6 mt-4 px-4 py-3 rounded-2xl text-white font-semibold border"></div>

      <!-- Cháº¿ Ä‘á»™ xem -->
      <div id="profileViewMode" class="p-6 bg-gradient-to-b from-purple-50/50 to-white">
        <!-- Avatar vÃ  thÃ´ng tin cÆ¡ báº£n -->
        <div class="bg-white rounded-3xl p-6 shadow-lg border-2 border-purple-100 mb-6">
          <div class="text-center mb-6">
            <div class="relative inline-block">
              <img id="viewAvatar" src="{{ user.avatar_url or '/static/default-avatar.png' }}" alt="Avatar" class="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-purple-300 shadow-lg mx-auto" />
              <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-purple-400 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                ğŸ‘¤
              </div>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mt-4" id="viewFullname">{{ fullname }}</h3>
            <p class="text-gray-500 text-sm" id="viewEmail">{{ user.email or "ChÆ°a cáº­p nháº­t" }}</p>
          </div>
        </div>

        <!-- ThÃ´ng tin chi tiáº¿t -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <!-- ThÃ´ng tin thá»ƒ cháº¥t -->
          <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-pink-100">
            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="text-xl">ğŸ“</span>
              ThÃ´ng tin thá»ƒ cháº¥t
            </h4>
            <div class="space-y-3">
              <div class="flex justify-between items-center py-2 border-b border-pink-100">
                <span class="text-gray-600 font-medium">Chiá»u cao:</span>
                <span class="font-bold text-pink-600" id="viewHeight">{{ user.height or "ChÆ°a cáº­p nháº­t" }} cm</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-pink-100">
                <span class="text-gray-600 font-medium">CÃ¢n náº·ng:</span>
                <span class="font-bold text-pink-600" id="viewWeight">{{ user.weight or "ChÆ°a cáº­p nháº­t" }} kg</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-pink-100">
                <span class="text-gray-600 font-medium">Tuá»•i:</span>
                <span class="font-bold text-pink-600" id="viewAge">{{ user.age or "ChÆ°a cáº­p nháº­t" }}</span>
              </div>
              <div class="flex justify-between items-center py-2">
                <span class="text-gray-600 font-medium">Giá»›i tÃ­nh:</span>
                <span class="font-bold text-pink-600" id="viewGender">
                  {% if user.gender == "male" %}Nam{% elif user.gender == "female" %}Ná»¯{% else %}ChÆ°a cáº­p nháº­t{% endif %}
                </span>
              </div>
            </div>
          </div>

          <!-- Chá»‰ sá»‘ sá»©c khá»e -->
          <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-blue-100">
            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
              <span class="text-xl">ğŸ“Š</span>
              Chá»‰ sá»‘ sá»©c khá»e
            </h4>
            <div class="space-y-4">
              <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
                <div class="flex justify-between items-center">
                  <span class="text-blue-600 font-medium">BMR:</span>
                  <span class="font-bold text-blue-700 text-lg" id="viewBmr">{{ bmr if bmr else "ChÆ°a cÃ³" }}</span>
                </div>
                <p class="text-xs text-blue-500 mt-1">kcal/ngÃ y (nghá»‰ ngÆ¡i)</p>
              </div>
              <div class="bg-green-50 rounded-xl p-4 border border-green-200">
                <div class="flex justify-between items-center">
                  <span class="text-green-600 font-medium">TDEE:</span>
                  <span class="font-bold text-green-700 text-lg" id="viewTdee">{{ tdee if tdee else "ChÆ°a cÃ³" }}</span>
                </div>
                <p class="text-xs text-green-500 mt-1">kcal/ngÃ y (hoáº¡t Ä‘á»™ng)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Button chá»‰nh sá»­a -->
        <button onclick="switchToEditProfile()" class="w-full bg-[#c8b2db] hover:bg-[#b8a0d0] text-white px-6 py-4 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 border-2 border-[#c8b2db] hover:border-[#b8a0d0]">
          <span class="text-xl">âœï¸</span> 
          <span>Chá»‰nh sá»­a thÃ´ng tin</span>
        </button>
      </div>

      <!-- Cháº¿ Ä‘á»™ chá»‰nh sá»­a -->
      <form id="profileForm" method="post" class="p-6 space-y-6 bg-gradient-to-b from-purple-50/50 to-white hidden" onsubmit="return submitProfileForm(event)" enctype="multipart/form-data">
        <!-- Avatar -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-purple-100">
          <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-xl">ğŸ–¼ï¸</span>
            áº¢nh Ä‘áº¡i diá»‡n
          </h4>
          <div class="text-center">
            <img id="editAvatarPreview" src="{{ user.avatar_url or '/static/default-avatar.png' }}" alt="Avatar Preview" class="w-24 h-24 rounded-full border-4 border-purple-300 shadow-lg mx-auto mb-4" />
            <div class="relative inline-block">
              <input type="file" id="profileAvatarFile" accept="image/*" class="hidden" />
              <button type="button" onclick="document.getElementById('profileAvatarFile').click()" class="bg-purple-100 hover:bg-purple-200 text-purple-600 px-4 py-2 rounded-xl font-semibold transition-all duration-200 border border-purple-300 hover:border-purple-400">
                ğŸ“· Chá»n áº£nh má»›i
              </button>
            </div>
          </div>
        </div>

        <!-- ThÃ´ng tin cÆ¡ báº£n -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-pink-100">
          <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-xl">ğŸ“</span>
            ThÃ´ng tin cÆ¡ báº£n
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-pink-400 rounded-full"></span>
                Há» tÃªn
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input type="text" name="fullname" id="profileFullname" required class="w-full border-2 border-pink-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-pink-300/30 focus:border-pink-400 transition-all duration-300 font-medium text-gray-700 pl-12" />
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-pink-400 text-lg">
                  ğŸ‘¤
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-blue-400 rounded-full"></span>
                Email
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input type="email" name="email" id="profileEmail" required class="w-full border-2 border-blue-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-blue-300/30 focus:border-blue-400 transition-all duration-300 font-medium text-gray-700 pl-12" />
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-blue-400 text-lg">
                  ğŸ“§
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ThÃ´ng tin thá»ƒ cháº¥t -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-green-100">
          <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-xl">ğŸ“</span>
            ThÃ´ng tin thá»ƒ cháº¥t
          </h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                Chiá»u cao (cm)
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input type="number" name="height" id="profileHeight" required class="w-full border-2 border-green-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-green-300/30 focus:border-green-400 transition-all duration-300 font-medium text-gray-700 pl-12" />
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-green-400 text-lg">
                  ğŸ“
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
                CÃ¢n náº·ng (kg)
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input type="number" name="weight" id="profileWeight" required class="w-full border-2 border-yellow-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-yellow-300/30 focus:border-yellow-400 transition-all duration-300 font-medium text-gray-700 pl-12" />
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-yellow-400 text-lg">
                  âš–ï¸
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                Tuá»•i
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <input type="number" name="age" id="profileAge" required class="w-full border-2 border-purple-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-purple-300/30 focus:border-purple-400 transition-all duration-300 font-medium text-gray-700 pl-12" />
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400 text-lg">
                  ğŸ‚
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="block font-semibold text-gray-700 flex items-center gap-2">
                <span class="w-2 h-2 bg-red-400 rounded-full"></span>
                Giá»›i tÃ­nh
                <span class="text-red-500 text-lg">*</span>
              </label>
              <div class="relative">
                <select name="gender" id="profileGender" required class="w-full border-2 border-red-200 bg-white p-4 rounded-2xl focus:outline-none focus:ring-4 focus:ring-red-300/30 focus:border-red-400 transition-all duration-300 font-medium text-gray-700 appearance-none cursor-pointer pl-12">
                  <option value="male">Nam</option>
                  <option value="female">Ná»¯</option>
                </select>
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-red-400 text-lg">
                  âš§ï¸
                </div>
                <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
                  <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4">
          <button type="button" onclick="switchToViewProfile()" class="w-full sm:w-auto order-2 sm:order-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-2xl font-semibold transition-all duration-200 border-2 border-gray-200 hover:border-gray-300">
            Huá»·
          </button>
          <button type="submit" class="w-full sm:w-auto order-1 sm:order-2 bg-[#c8b2db] hover:bg-[#b8a0d0] text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2 border-2 border-[#c8b2db] hover:border-[#b8a0d0]">
            <span class="text-xl">ğŸ’¾</span> 
            <span>LÆ°u thÃ´ng tin</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
/* Enhanced Modal Styles vá»›i pastel colors vÃ  responsive */
#activityModal, #activityHistoryModal, #profileModal {
  backdrop-filter: blur(8px);
}

/* Custom select arrow */
select {
  background-image: none !important;
}

/* Enhanced input focus states */
#activityModal input:focus,
#activityModal select:focus,
#activityHistoryModal input:focus,
#profileModal input:focus,
#profileModal select:focus {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Input vá»›i icon bÃªn trÃ¡i */
.relative input[class*="pl-12"] {
  padding-left: 3rem;
}

/* Enhanced button hover states */
#activityModal button,
#activityHistoryModal button,
#profileModal button {
  position: relative;
  overflow: hidden;
}

#activityModal button:hover,
#activityHistoryModal button:hover,
#profileModal button:hover {
  transform: translateY(-1px);
}

/* Enhanced placeholder styles */
#activityModal input::placeholder,
#activityModal select option:first-child,
#profileModal input::placeholder {
  color: #9ca3af;
  font-style: italic;
}

/* Enhanced activity history table */
#activityHistoryContent table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: white;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

#activityHistoryContent th {
  background: #a0e7a0;
  color: white;
  font-weight: 600;
  text-align: center;
  padding: 1rem;
  border-bottom: 2px solid #4ade80;
}

#activityHistoryContent td {
  padding: 0.875rem 1rem;
  border-bottom: 1px solid #e5e7eb;
  text-align: center;
  vertical-align: middle;
}

#activityHistoryContent tr:nth-child(even) {
  background-color: #f0fdf4;
}

#activityHistoryContent tr:hover {
  background-color: #dcfce7;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
}

/* Profile modal stats cards */
.profile-stat-card {
  transition: all 0.3s ease;
  cursor: pointer;
}

.profile-stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

/* Enhanced responsive styles */
@media (max-width: 640px) {
  #activityModal .max-w-md,
  #activityHistoryModal .max-w-4xl,
  #profileModal .max-w-2xl {
    max-width: calc(100vw - 2rem);
    margin: 0 1rem;
  }
  
  #activityModal .px-6,
  #activityHistoryModal .px-6,
  #profileModal .px-6 {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  #activityModal .p-6,
  #activityHistoryModal .p-6,
  #profileModal .p-6 {
    padding: 1rem;
  }
  
  #activityModal .space-y-5,
  #activityHistoryModal .space-y-6,
  #profileModal .space-y-6 {
    gap: 1rem;
  }
  
  #activityModal input,
  #activityModal select,
  #profileModal input,
  #profileModal select {
    padding: 0.875rem;
    padding-left: 2.5rem;
    font-size: 16px; /* Prevents zoom on iOS */
  }
  
  #activityModal .pl-12,
  #profileModal .pl-12 {
    padding-left: 2.5rem;
  }
  
  #activityModal button,
  #activityHistoryModal button,
  #profileModal button {
    padding: 0.875rem 1.5rem;
    font-size: 0.875rem;
  }
  
  /* Icon adjustments for mobile */
  #activityModal .absolute.left-4,
  #profileModal .absolute.left-4 {
    left: 0.75rem;
  }
  
  /* Avatar size adjustments */
  #profileModal #viewAvatar,
  #profileModal #editAvatarPreview {
    width: 5rem;
    height: 5rem;
  }
  
  /* Grid adjustments */
  #profileModal .md\:grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  #profileModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr 1fr;
  }
  
  /* Table responsive */
  #activityHistoryContent {
    overflow-x: auto;
  }
  
  #activityHistoryContent table {
    min-width: 600px;
    font-size: 0.875rem;
  }
  
  #activityHistoryContent th,
  #activityHistoryContent td {
    padding: 0.75rem 0.5rem;
    white-space: nowrap;
  }
}

@media (max-width: 480px) {
  #activityModal .max-w-md,
  #activityHistoryModal .max-w-4xl,
  #profileModal .max-w-2xl {
    max-width: calc(100vw - 1rem);
    margin: 0 0.5rem;
  }
  
  #activityModal .rounded-3xl,
  #activityHistoryModal .rounded-3xl,
  #profileModal .rounded-3xl {
    border-radius: 1.5rem;
  }
  
  #activityModal .rounded-2xl,
  #activityHistoryModal .rounded-2xl,
  #profileModal .rounded-2xl {
    border-radius: 1rem;
  }
  
  #profileModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr;
  }
  
  #activityModal .text-xl,
  #activityHistoryModal .text-xl,
  #profileModal .text-xl {
    font-size: 1.125rem;
  }
  
  #activityModal .text-lg,
  #activityHistoryModal .text-lg,
  #profileModal .text-lg {
    font-size: 1rem;
  }
  
  /* Smaller activity history table for very small screens */
  #activityHistoryContent table {
    min-width: 400px;
    font-size: 0.8rem;
  }
  
  #activityHistoryContent th,
  #activityHistoryContent td {
    padding: 0.5rem 0.25rem;
  }
}

/* Tablet specific optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  #profileModal .lg\:grid-cols-4 {
    grid-template-columns: 1fr 1fr;
  }
  
  #activityHistoryModal .max-w-4xl,
  #profileModal .max-w-2xl {
    max-width: calc(100vw - 4rem);
  }
}

/* Enhanced form validation styles */
#activityModal input:invalid:not(:focus):not(:placeholder-shown),
#activityModal select:invalid:not(:focus),
#profileModal input:invalid:not(:focus):not(:placeholder-shown),
#profileModal select:invalid:not(:focus) {
  border-color: #ef4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

#activityModal input:valid:not(:focus):not(:placeholder-shown),
#activityModal select:valid:not(:focus),
#profileModal input:valid:not(:focus):not(:placeholder-shown),
#profileModal select:valid:not(:focus) {
  border-color: #10b981;
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

/* Enhanced loading states */
#activityModal .loading,
#activityHistoryModal .loading,
#profileModal .loading {
  opacity: 0.7;
  pointer-events: none;
}

/* Enhanced accessibility */
#activityModal [role="button"],
#activityHistoryModal [role="button"],
#profileModal [role="button"] {
  cursor: pointer;
}

/* Enhanced animation for modal appearance */
#activityModal.show,
#activityHistoryModal.show,
#profileModal.show {
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  #activityModal input,
  #activityModal select,
  #activityHistoryModal input,
  #profileModal input,
  #profileModal select {
    border-width: 3px;
  }
  
  #activityModal button,
  #activityHistoryModal button,
  #profileModal button {
    border-width: 3px;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  #activityModal,
  #activityHistoryModal,
  #profileModal,
  #activityModal *,
  #activityHistoryModal *,
  #profileModal * {
    animation: none !important;
    transition: none !important;
  }
}

/* Dark mode preparation */
@media (prefers-color-scheme: dark) {
  #activityModal .bg-white,
  #activityHistoryModal .bg-white,
  #profileModal .bg-white {
    background: #1f2937;
    color: #f9fafb;
  }
  
  #activityModal input,
  #activityModal select,
  #activityHistoryModal input,
  #profileModal input,
  #profileModal select {
    background: #374151;
    color: #f9fafb;
    border-color: #4b5563;
  }
}

/* Profile modal specific enhancements */
#profileModal .profile-section {
  border-left: 4px solid transparent;
  transition: all 0.3s ease;
}

#profileModal .profile-section:hover {
  border-left-color: #c8b2db;
  transform: translateX(4px);
}

/* Activity history empty state */
.activity-empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: #6b7280;
}

.activity-empty-state .icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

/* Enhanced scrollbar for activity history */
#activityHistoryContent {
  scrollbar-width: thin;
  scrollbar-color: #a0e7a0 #f3f4f6;
}

#activityHistoryContent::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

#activityHistoryContent::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 4px;
}

#activityHistoryContent::-webkit-scrollbar-thumb {
  background: #a0e7a0;
  border-radius: 4px;
  border: 1px solid #f3f4f6;
}

#activityHistoryContent::-webkit-scrollbar-thumb:hover {
  background: #4ade80;
}
</style>
<script>
  // Láº¥y thÃ´ng tin user tá»« backend (Jinja2)
  const userProfile = {
  fullname: "{{ fullname }}",
  email: "{{ user.email or '' }}",
  height: {{ user.height if user and user.height is defined else 'null' }},
  weight: {{ user.weight if user and user.weight is defined else 'null' }},
  age: {{ user.age if user and user.age is defined else 'null' }},
  gender: "{{ user.gender if user and user.gender is defined else '' }}",
  bmr: {{ "%.0f"|format(bmr) if bmr is defined and bmr else 'null' }},
  tdee: {{ "%.0f"|format(tdee) if tdee is defined and tdee else 'null' }},
  avatar_url: "{{ user.avatar_url or '' }}"
  };

  function openProfileModal() {
    document.getElementById('profileModal').classList.remove('hidden');
    switchToViewProfile();
    document.getElementById('viewFullname').textContent = userProfile.fullname || '';
    document.getElementById('viewHeight').textContent = (userProfile.height ? userProfile.height + ' cm' : 'ChÆ°a cáº­p nháº­t');
    document.getElementById('viewWeight').textContent = (userProfile.weight ? userProfile.weight + ' kg' : 'ChÆ°a cáº­p nháº­t');
    document.getElementById('viewAge').textContent = userProfile.age || 'ChÆ°a cáº­p nháº­t';
    document.getElementById('viewGender').textContent = userProfile.gender === 'male' ? 'Nam' : (userProfile.gender === 'female' ? 'Ná»¯' : 'ChÆ°a cáº­p nháº­t');
    document.getElementById('viewEmail').textContent = userProfile.email || 'ChÆ°a cáº­p nháº­t';
    document.getElementById('viewBmr').textContent = userProfile.bmr || 'ChÆ°a cÃ³';
    document.getElementById('viewTdee').textContent = userProfile.tdee || 'ChÆ°a cÃ³';
    document.getElementById('viewAvatar').src = userProfile.avatar_url || "{{ user.avatar_url or '/static/default-avatar.png' }}";
  }
  function closeProfileModal() {
    document.getElementById('profileModal').classList.add('hidden');
  }
  function switchToEditProfile() {
    document.getElementById('profileViewMode').classList.add('hidden');
    document.getElementById('profileForm').classList.remove('hidden');
    document.getElementById('profileFullname').value = userProfile.fullname || '';
    document.getElementById('profileHeight').value = userProfile.height || '';
    document.getElementById('profileWeight').value = userProfile.weight || '';
    document.getElementById('profileAge').value = userProfile.age || '';
    document.getElementById('profileGender').value = userProfile.gender || 'male';
    document.getElementById('profileEmail').value = userProfile.email || '';
    document.getElementById('profileAvatarFile').value = '';
    document.getElementById('editAvatarPreview').src = userProfile.avatar_url || "{{ user.avatar_url or '/static/default-avatar.png' }}";
  }
  // Xem trÆ°á»›c áº£nh Ä‘áº¡i diá»‡n khi chá»n file má»›i
  const avatarInput = document.getElementById('profileAvatarFile');
  if (avatarInput && !avatarInput.dataset.bound) {
    avatarInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (ev) {
          document.getElementById('editAvatarPreview').src = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
    avatarInput.dataset.bound = "1";
  }
  function switchToViewProfile() {
    document.getElementById('profileViewMode').classList.remove('hidden');
    document.getElementById('profileForm').classList.add('hidden');
  }
  // Gá»­i form cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n báº±ng fetch (AJAX)
  function showProfileNotice(message, success = true) {
    const notice = document.getElementById('profileNotice');
    notice.textContent = message;
    notice.className = 'mb-2 px-4 py-2 rounded font-semibold ' + (success ? 'bg-green-500' : 'bg-red-500');
    notice.style.display = '';
    setTimeout(() => { notice.style.display = 'none'; }, 2500);
  }
  function submitProfileForm(event) {
    event.preventDefault();
    const form = document.getElementById('profileForm');
    const formData = new FormData(form);
    // Náº¿u cÃ³ file, thÃªm vÃ o formData
    const fileInput = document.getElementById('profileAvatarFile');
    if (fileInput.files.length > 0) {
      formData.append('avatar_file', fileInput.files[0]);
    }
    fetch('/profile', {
      method: 'POST',
      body: formData,
      credentials: 'same-origin'
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        userProfile.fullname = data.data.fullname;
        userProfile.height = data.data.height;
        userProfile.weight = data.data.weight;
        userProfile.age = data.data.age;
        userProfile.gender = data.data.gender;
        userProfile.email = data.data.email;
        // LÃ m trÃ²n BMR vÃ  TDEE
        userProfile.bmr = data.data.bmr ? Math.round(data.data.bmr) : null;
        userProfile.tdee = data.data.tdee ? Math.round(data.data.tdee) : null;
        userProfile.avatar_url = data.data.avatar_url || '';
        switchToViewProfile();
        openProfileModal();
        showProfileNotice(data.message, true);
      } else {
        showProfileNotice(data.message || "CÃ³ lá»—i xáº£y ra!", false);
      }
    });
    return false;
  }
</script>
  </body>
</html>
